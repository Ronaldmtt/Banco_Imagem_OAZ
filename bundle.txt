================================================================================
OAZ SMART IMAGE BANK - BUNDLE COMPLETO DO PROJETO
Gerado em: $(date)
================================================================================


================================================================================
ARQUIVO: ./app.py
================================================================================
import os
import io
import csv
from datetime import datetime
from flask import Flask, render_template, redirect, url_for, flash, request, Response, make_response
from flask_sqlalchemy import SQLAlchemy
from flask_login import LoginManager, UserMixin, login_user, login_required, logout_user, current_user
from werkzeug.security import generate_password_hash, check_password_hash
from werkzeug.utils import secure_filename
from openai import OpenAI
from dotenv import load_dotenv
import json
import base64

# Load environment variables
load_dotenv()

# Configuration
class Config:
    SECRET_KEY = 'dev-secret-key-oaz-img' # Change in production
    SQLALCHEMY_DATABASE_URI = 'sqlite:///oaz_img.db'
    SQLALCHEMY_TRACK_MODIFICATIONS = False
    UPLOAD_FOLDER = 'static/uploads'
    ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}

app = Flask(__name__)
app.config.from_object(Config)

# Ensure upload directory exists
os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)

db = SQLAlchemy(app)
login_manager = LoginManager(app)
login_manager.login_view = 'login'

# Models
class User(UserMixin, db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    password_hash = db.Column(db.String(128))
    
    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
        
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)

class SystemConfig(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    key = db.Column(db.String(50), unique=True, nullable=False)
    value = db.Column(db.Text, nullable=False)

class Brand(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False, unique=True)
    description = db.Column(db.Text)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    images = db.relationship('Image', backref='brand_ref', lazy=True)

class Collection(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    description = db.Column(db.Text)
    season = db.Column(db.String(50))  # Estação: Primavera/Verão, Outono/Inverno
    year = db.Column(db.Integer)  # Ano da coleção
    campanha = db.Column(db.String(100))  # Nome da campanha
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    images = db.relationship('Image', backref='collection', lazy=True)

class Image(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    filename = db.Column(db.String(255), nullable=False)
    original_name = db.Column(db.String(255), nullable=False)
    description = db.Column(db.Text)
    sku = db.Column(db.String(50))
    brand_id = db.Column(db.Integer, db.ForeignKey('brand.id'))
    status = db.Column(db.String(20), default='Pendente')
    upload_date = db.Column(db.DateTime, default=datetime.utcnow)
    shooting_date = db.Column(db.Date)
    photographer = db.Column(db.String(100))
    unique_code = db.Column(db.String(50), unique=True)
    collection_id = db.Column(db.Integer, db.ForeignKey('collection.id'))
    uploader_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    tags = db.Column(db.Text)
    
    # AI-extracted attributes (legacy - mantido para retrocompatibilidade)
    ai_item_type = db.Column(db.String(100))
    ai_color = db.Column(db.String(50))
    ai_material = db.Column(db.String(100))
    ai_pattern = db.Column(db.String(50))
    ai_style = db.Column(db.String(50))
    
    # Relationship with individual items detected in image
    items = db.relationship('ImageItem', backref='image', lazy=True, cascade='all, delete-orphan')

class ImageItem(db.Model):
    """Representa uma peça individual detectada em uma imagem"""
    id = db.Column(db.Integer, primary_key=True)
    image_id = db.Column(db.Integer, db.ForeignKey('image.id'), nullable=False)
    item_order = db.Column(db.Integer, default=1)  # Ordem da peça na imagem
    
    # Descrição específica desta peça
    description = db.Column(db.Text)
    tags = db.Column(db.Text)  # JSON array
    
    # Atributos IA específicos desta peça
    ai_item_type = db.Column(db.String(100))
    ai_color = db.Column(db.String(50))
    ai_material = db.Column(db.String(100))
    ai_pattern = db.Column(db.String(50))
    ai_style = db.Column(db.String(50))
    
    # Referência visual (ex: "peça superior", "peça inferior", "acessório")
    position_ref = db.Column(db.String(50))

class Produto(db.Model):
    """Modelo de Produto com SKU e atributos técnicos"""
    id = db.Column(db.Integer, primary_key=True)
    sku = db.Column(db.String(50), unique=True, nullable=False)
    descricao = db.Column(db.String(255), nullable=False)
    cor = db.Column(db.String(50))
    categoria = db.Column(db.String(100))
    atributos_tecnicos = db.Column(db.Text)  # JSON com atributos extras
    
    # Relacionamentos
    marca_id = db.Column(db.Integer, db.ForeignKey('brand.id'))
    colecao_id = db.Column(db.Integer, db.ForeignKey('collection.id'))
    
    # Metadados
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Flags
    tem_foto = db.Column(db.Boolean, default=False)
    ativo = db.Column(db.Boolean, default=True)
    
    # Relationships
    marca = db.relationship('Brand', backref='produtos')
    colecao = db.relationship('Collection', backref='produtos')
    imagens = db.relationship('ImagemProduto', backref='produto', lazy=True, cascade='all, delete-orphan')
    historico_skus = db.relationship('HistoricoSKU', backref='produto', lazy=True)

class ImagemProduto(db.Model):
    """Associação entre Imagem e Produto (uma imagem pode ter vários produtos)"""
    id = db.Column(db.Integer, primary_key=True)
    imagem_id = db.Column(db.Integer, db.ForeignKey('image.id'), nullable=False)
    produto_id = db.Column(db.Integer, db.ForeignKey('produto.id'), nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # Relacionamentos
    imagem = db.relationship('Image', backref='produtos_associados')

class HistoricoSKU(db.Model):
    """Histórico de alterações de SKU para rastreabilidade"""
    id = db.Column(db.Integer, primary_key=True)
    produto_id = db.Column(db.Integer, db.ForeignKey('produto.id'), nullable=False)
    sku_antigo = db.Column(db.String(50), nullable=False)
    sku_novo = db.Column(db.String(50), nullable=False)
    data_alteracao = db.Column(db.DateTime, default=datetime.utcnow)
    motivo = db.Column(db.String(255))
    usuario_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    
    usuario = db.relationship('User', backref='alteracoes_sku')

class CarteiraCompras(db.Model):
    """Carteira de compras importada para comparação com itens fotografados"""
    id = db.Column(db.Integer, primary_key=True)
    sku = db.Column(db.String(50), nullable=False)
    descricao = db.Column(db.String(255))
    cor = db.Column(db.String(50))
    categoria = db.Column(db.String(100))
    quantidade = db.Column(db.Integer, default=1)
    
    # Status
    status_foto = db.Column(db.String(20), default='Pendente')  # Pendente, Com Foto, Sem Foto
    produto_id = db.Column(db.Integer, db.ForeignKey('produto.id'))  # Link com produto se existir
    
    # Metadados de importação
    data_importacao = db.Column(db.DateTime, default=datetime.utcnow)
    lote_importacao = db.Column(db.String(50))  # Identificador do lote de importação
    
    # Relacionamento
    produto = db.relationship('Produto', backref='itens_carteira')

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

def get_openai_client():
    # First try to get from DB
    config = SystemConfig.query.filter_by(key='OPENAI_API_KEY').first()
    if config:
        return OpenAI(api_key=config.value)
    
    # Fallback to env var
    api_key = os.getenv('OPENAI_API_KEY')
    if api_key:
        return OpenAI(api_key=api_key)
    
    return None

def encode_image(image_path):
    with open(image_path, "rb") as image_file:
        return base64.b64encode(image_file.read()).decode('utf-8')

def analyze_image_with_ai(image_path):
    client = get_openai_client()
    if not client:
        return "AI Configuration missing. Please configure OpenAI API Key in Settings.", []
    
    try:
        base64_image = encode_image(image_path)
        
        prompt = """
        Você é um especialista em moda e têxteis analisando imagens para o banco de imagens OAZ (varejo de moda profissional).
        Sua análise deve ser EXTREMAMENTE PRECISA para catalogação e verificação de SKUs.
        
        RESPONDA TUDO EM PORTUGUÊS DO BRASIL.
        
        ═══════════════════════════════════════════════════════════════════
        1. TIPO DE ITEM - Identifique com precisão:
        ═══════════════════════════════════════════════════════════════════
        
        VESTIDOS (com modelagem):
        - Vestido Tubinho (justo, segue o corpo)
        - Vestido Evasê (cintura marcada, saia em A)
        - Vestido Ciganinha/Ombro a Ombro
        - Vestido Chemise (estilo camisa, com botões)
        - Vestido Transpassado (amarração lateral)
        - Vestido Tomara que Caia
        - Vestido Godê (saia rodada e ampla)
        - Vestido Peplum (babado na cintura)
        
        BLUSAS/TOPS:
        - Camiseta/T-shirt, Camisa Social, Regata, Top/Cropped
        - Blusa de Alcinha, Body, Blusa Ciganinha
        - Blusa de Renda/Laise, Bata, Polo
        
        CALÇAS (com modelagem):
        - Skinny, Flare/Boca de Sino, Pantalona/Wide Leg
        - Reta, Cargo, Jogger, Legging, Alfaiataria, Cigarrete
        
        SAIAS: Lápis, Evasê, Godê, Plissada, Envelope/Transpassada
        
        OUTROS: Blazer, Jaqueta, Cardigan, Suéter, Macacão, Shorts, Bermuda
        
        COMPRIMENTOS: Curto, Midi, Longo, Cropped, Mini, Maxi
        
        ═══════════════════════════════════════════════════════════════════
        2. COR - Seja específico com nuances:
        ═══════════════════════════════════════════════════════════════════
        Exemplos: Azul Marinho, Azul Royal, Azul Bebê, Vermelho Vinho, 
        Vermelho Ferrari, Rosa Blush, Rosa Pink, Preto, Branco Off-White,
        Bege Areia, Marrom Chocolate, Marrom Caramelo, Verde Militar,
        Verde Esmeralda, Cinza Chumbo, Cinza Mescla, Nude, Terracota
        
        ═══════════════════════════════════════════════════════════════════
        3. MATERIAL/TECIDO - ANÁLISE CRÍTICA (mais importante!)
        ═══════════════════════════════════════════════════════════════════
        
        ▼▼▼ TECIDOS TRANSPARENTES E DELICADOS (PRIORIDADE MÁXIMA) ▼▼▼
        
        ★★★ ANÁLISE DE MATERIAIS EM CAMADAS (MUITO IMPORTANTE!) ★★★
        
        Muitas peças têm MÚLTIPLOS materiais sobrepostos. Analise em DUAS ETAPAS:
        
        ETAPA 1 - IDENTIFIQUE A BASE (tecido que cobre o corpo):
        - Se há uma TELA/MALHA TRANSPARENTE cobrindo grande área = BASE é TULE
        - Sinais visuais: diferença no tom da pele entre áreas cobertas (mais escuras/acinzentadas) 
          e áreas descobertas (mãos, pescoço, rosto têm tom de pele natural)
        - Se a pele aparece "velada" ou com tom diferente = há uma camada de TULE por baixo
        
        ETAPA 2 - IDENTIFIQUE APLICAÇÕES/DETALHES (sobre a base):
        - Bordados, desenhos florais, arabescos = APLICAÇÃO de RENDA
        - Pedrarias, paetês = aplicações decorativas
        
        ★ REGRA DE NOMENCLATURA:
        - Base de tule + desenhos de renda = "Tule com renda aplicada" (NÃO apenas "Renda"!)
        - Base de tule + bordados = "Tule bordado"
        - Apenas malha transparente uniforme = "Tule"
        - Renda sem base transparente (autossustentada) = "Renda guipir"
        - Renda delicada com desenhos florais = "Renda chantilly"
        
        ⚠️ DICA VISUAL CRÍTICA:
        Se você observa que o TOM DA PELE é diferente entre:
        - Mãos/pescoço/rosto (tom natural, sem cobertura)
        - Braços/torso/pernas (tom mais escuro/velado)
        Isso indica que há uma CAMADA DE TULE como base, mesmo que tenha desenhos por cima!
        Neste caso, identifique como "Tule com renda" ou "Tule com detalhes de renda"
        
        TULE (base transparente):
        - Grade/rede transparente cobrindo grandes áreas do corpo
        - Cria efeito "véu" na pele - altera o tom visual
        
        RENDA (aplicação decorativa):
        - Desenhos ornamentais (flores, arabescos)
        - Geralmente aplicada SOBRE uma base (tule ou forro)
        
        ORGANZA:
        - Visual: Transparente, RÍGIDO, brilho acetinado
        - Estrutura: Armado, mantém forma, não é vazado como tule
        - Uso: Saias estruturadas, vestidos de festa
        
        CHIFFON:
        - Visual: Transparente, MUITO FLUIDO e esvoaçante
        - Estrutura: Leve, sem estrutura, cai naturalmente
        - Uso: Vestidos leves, blusas, lenços
        
        VOAL:
        - Visual: Semi-transparente, intermediário
        - Estrutura: Entre organza e chiffon
        
        ▼▼▼ FIBRAS NATURAIS (SEM BRILHO) ▼▼▼
        
        ALGODÃO:
        - Visual: OPACO, mate, sem brilho, trama uniforme
        - Toque: Macio, fresco, confortável
        - Amassa: Sim, moderadamente
        - Uso: Camisetas, calças, roupas básicas
        
        LINHO:
        - Visual: Textura RÚSTICA, aspecto AMASSADO natural
        - Toque: Fresco, levemente áspero
        - Amassa: MUITO (é característica do tecido)
        - Uso: Roupas de verão, peças elegantes
        
        SEDA:
        - Visual: Brilho LUXUOSO e NATURAL, muito lisa
        - Toque: Extremamente macio e suave
        - Caimento: Fluido e delicado
        - Uso: Vestidos de festa, blusas finas
        
        LÃ:
        - Visual: Textura peluda/felpuda, encorpado
        - Toque: Quente, pode ser áspero ou macio
        - Uso: Casacos, suéteres, inverno
        
        ▼▼▼ FIBRAS ARTIFICIAIS (de celulose) ▼▼▼
        
        VISCOSE:
        - Visual: Brilho SUTIL sedoso, OPACA (não transparente!)
        - Toque: Macio, fresco, similar ao algodão
        - Caimento: Fluido, molda o corpo
        - Amassa: Sim, facilmente
        - ATENÇÃO: Viscose NÃO é transparente! Se for transparente, é outro tecido!
        
        MODAL:
        - Visual: Similar à viscose, mais macio
        - Toque: Muito suave, sedoso
        - Uso: Roupas íntimas, camisetas premium
        
        ▼▼▼ FIBRAS SINTÉTICAS (derivadas de petróleo) ▼▼▼
        
        POLIÉSTER:
        - Visual: Brilho ARTIFICIAL e direto, aspecto "plástico"
        - Toque: Liso, levemente rígido
        - Amassa: NÃO amassa
        - Uso: Roupas esportivas, uniformes, misturas
        
        POLIAMIDA/NYLON:
        - Visual: Liso, brilhante, leve
        - Uso: Roupas esportivas, meias, lingerie
        
        ▼▼▼ MALHAS ▼▼▼
        
        TRICÔ:
        - Visual: Pontos ENTRELAÇADOS visíveis, textura artesanal
        - Uso: Suéteres, cardigans, vestidos de inverno
        
        MOLETOM:
        - Visual: Face externa lisa, interna felpuda
        - Uso: Moletons, casacos casuais
        
        RIBANA/CANELADA:
        - Visual: Nervuras VERTICAIS paralelas
        - Alta elasticidade
        - Uso: Punhos, golas, camisetas justas
        
        ▼▼▼ TECIDOS ESTRUTURADOS ▼▼▼
        
        JEANS/DENIM:
        - Visual: Diagonal característica, resistente
        - Cores: Azul índigo (claro/escuro), preto, branco
        
        SARJA:
        - Visual: Linhas DIAGONAIS bem visíveis (45°)
        - Uso: Calças, uniformes, shorts
        
        GABARDINE:
        - Visual: Liso com brilho sutil, muito estruturado
        - Uso: Alfaiataria, uniformes, blazers
        
        CREPE:
        - Visual: Textura GRANULADA, opaco, caimento pesado
        - Uso: Vestidos elegantes, alfaiataria
        
        CETIM/SATIN:
        - Visual: MUITO BRILHANTE, liso, escorregadio
        - Uso: Vestidos de festa, lingerie
        
        VELUDO:
        - Visual: Superfície PELUDA/felpuda, brilho característico
        - Uso: Vestidos de festa, blazers, inverno
        
        COURO/COURINO:
        - Visual: Liso, brilhante ou fosco, aspecto de pele
        - Uso: Jaquetas, calças, saias
        
        ═══════════════════════════════════════════════════════════════════
        4. ESTAMPA/PADRÃO:
        ═══════════════════════════════════════════════════════════════════
        Liso, Listrado (horizontal/vertical), Floral (grande/pequeno/delicado),
        Xadrez, Poá/Bolinhas, Geométrico, Animal Print (onça/zebra/cobra),
        Abstrato, Tie-Dye, Étnico, Tropical, Paisley, Camuflado
        
        ═══════════════════════════════════════════════════════════════════
        5. ESTILO (seja específico e baseado no USO da peça):
        ═══════════════════════════════════════════════════════════════════
        Analise o CONTEXTO DE USO da peça, não apenas sua aparência:
        
        - Festa/Gala: vestidos elegantes, peças brilhantes para eventos noturnos
        - Social/Trabalho: alfaiataria, camisas, peças formais para escritório
        - Dia a Dia/Urbano: peças práticas para uso cotidiano
        - Streetwear: estilo de rua, oversized, tênis, bonés
        - Minimalista: linhas limpas, cores neutras, sem ornamentos
        - Boho/Bohemian: fluido, étnico, franjas, estampas naturais
        - Esportivo/Athleisure: confortável, funcional, para exercícios ou lazer
        - Praia/Resort: leve, estampas tropicais, tecidos frescos
        - Vintage/Retrô: inspiração em décadas passadas
        - Balada/Noite: peças ousadas, recortes, transparências
        
        ⚠️ EVITE estilos genéricos. Use o contexto de USO real da peça.
        ⚠️ NÃO classifique como "Romântico" apenas por ter renda/tule - analise o contexto.
        
        ═══════════════════════════════════════════════════════════════════
        6. DESCRIÇÃO DETALHADA (CRÍTICO para verificação de SKU):
        ═══════════════════════════════════════════════════════════════════
        
        INCLUA OBRIGATORIAMENTE:
        □ Tipo exato e modelagem (tubinho, evasê, skinny, etc.)
        □ Comprimento preciso (curto, midi, longo, cropped, 7/8)
        □ Cintura (alta, média, baixa)
        □ Decote (V, redondo, quadrado, tomara que caia, ombro a ombro)
        □ Mangas (sem manga, curta, 3/4, longa, bufante, sino)
        □ Detalhes de design (botões, zíperes, bolsos, pregas, franzidos)
        □ Acabamentos (babados, rendas, bordados, recortes)
        □ Aviamentos visíveis (fivelas, argolas, ilhoses)
        □ Características ÚNICAS que diferenciam esta peça
        
        Exemplo de descrição boa:
        "Vestido midi evasê em crepe preto com decote V profundo, mangas 3/4 
        bufantes com elástico no punho, cintura marcada com cinto removível 
        de mesma cor com fivela dourada, saia fluida com comprimento abaixo 
        do joelho, fechamento por zíper invisível nas costas, forro completo."
        
        ═══════════════════════════════════════════════════════════════════
        7. DETECÇÃO DE MÚLTIPLAS PEÇAS:
        ═══════════════════════════════════════════════════════════════════
        
        IMPORTANTE: Analise a imagem e identifique TODAS as peças de roupa visíveis.
        
        - Se houver APENAS UMA peça: retorne um array "items" com 1 item
        - Se houver MÚLTIPLAS peças (ex: blusa + calça, vestido + bolsa): retorne cada uma separadamente
        - Máximo de 4 peças por imagem
        
        Para cada peça, identifique sua POSIÇÃO na imagem:
        - "Peça Superior" (blusas, camisas, tops, jaquetas)
        - "Peça Inferior" (calças, saias, shorts)
        - "Peça Única" (vestidos, macacões)
        - "Acessório" (bolsas, cintos, chapéus)
        - "Calçado" (sapatos, tênis, sandálias)
        
        ═══════════════════════════════════════════════════════════════════
        
        FORMATO DE RESPOSTA (JSON estrito com MÚLTIPLAS PEÇAS):
        {
            "item_count": 1,
            "items": [
                {
                    "position_ref": "Peça Superior/Inferior/Única/Acessório/Calçado",
                    "description": "Descrição ultra-detalhada desta peça...",
                    "attributes": {
                        "item_type": "Tipo + Modelagem + Comprimento",
                        "color": "Cor com nuance específica",
                        "material": "Material identificado com precisão",
                        "pattern": "Estampa ou Liso",
                        "style": "Estilo específico"
                    },
                    "seo_keywords": ["keyword1", "keyword2", "keyword3"]
                }
            ]
        }
        
        Se houver 2 peças (ex: blusa e calça):
        {
            "item_count": 2,
            "items": [
                {
                    "position_ref": "Peça Superior",
                    "description": "Descrição da blusa...",
                    "attributes": {...},
                    "seo_keywords": [...]
                },
                {
                    "position_ref": "Peça Inferior",
                    "description": "Descrição da calça...",
                    "attributes": {...},
                    "seo_keywords": [...]
                }
            ]
        }
        
        REGRAS PARA KEYWORDS:
        ✗ PROIBIDO: casual, moda casual, roupa feminina, moda, fashion, look, outfit, estilo
        ✓ USE: termos específicos do produto (material, cor, modelagem, detalhes)
        """
        
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": prompt},
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": f"data:image/jpeg;base64,{base64_image}"
                            },
                        },
                    ],
                }
            ],
            response_format={"type": "json_object"},
            max_tokens=1200,
        )
        
        content = response.choices[0].message.content
        data = json.loads(content)
        
        # Tags genéricas a serem filtradas (não agregam valor)
        generic_tags = [
            'casual', 'moda casual', 'roupa feminina', 'roupa masculina',
            'moda feminina', 'moda masculina', 'vestuário', 'roupa',
            'fashion', 'moda', 'look', 'outfit', 'estilo casual'
        ]
        
        def filter_tags(attributes, keywords):
            """Filtra e gera tags a partir de atributos e keywords"""
            tags = []
            for key, value in attributes.items():
                if value and value.lower() != 'none' and value.lower() != 'n/a':
                    if value.lower() not in generic_tags:
                        tags.append(value)
            for keyword in keywords:
                if keyword.lower() not in generic_tags:
                    tags.append(keyword)
            return list(set(tags))
        
        # Novo formato com múltiplas peças
        if 'items' in data and isinstance(data['items'], list):
            items_data = []
            for idx, item in enumerate(data['items']):
                item_attributes = item.get('attributes', {})
                item_keywords = item.get('seo_keywords', [])
                item_tags = filter_tags(item_attributes, item_keywords)
                
                items_data.append({
                    'order': idx + 1,
                    'position_ref': item.get('position_ref', f'Peça {idx + 1}'),
                    'description': item.get('description', ''),
                    'tags': item_tags,
                    'attributes': item_attributes
                })
            
            # Retorna lista de itens
            return items_data
        
        # Fallback: formato antigo (uma peça só)
        description = data.get('description', '')
        attributes = data.get('attributes', {})
        keywords = data.get('seo_keywords', [])
        tags = filter_tags(attributes, keywords)
        
        # Retorna como lista com um item para compatibilidade
        return [{
            'order': 1,
            'position_ref': 'Peça Única',
            'description': description,
            'tags': tags,
            'attributes': attributes
        }]
        
    except Exception as e:
        print(f"AI Analysis Error: {e}")
        return f"Erro ao analisar imagem: {str(e)}"

# Routes
@app.route('/')
def index():
    if current_user.is_authenticated:
        return redirect(url_for('dashboard'))
    return redirect(url_for('login'))

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        print(f"[DEBUG] Login attempt - Username: {username}, Password length: {len(password) if password else 0}")
        user = User.query.filter_by(username=username).first()
        print(f"[DEBUG] User found: {user is not None}")
        if user:
            password_check = user.check_password(password)
            print(f"[DEBUG] Password check result: {password_check}")
            if password_check:
                login_user(user)
                print(f"[DEBUG] User logged in successfully: {user.username}")
                return redirect(url_for('dashboard'))
        flash('Usuário ou senha inválidos')
        print(f"[DEBUG] Login failed")
    return render_template('auth/login.html')

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        username = request.form.get('username')
        email = request.form.get('email')
        password = request.form.get('password')
        
        if User.query.filter_by(username=username).first():
            flash('Nome de usuário já existe')
            return redirect(url_for('register'))
            
        user = User(username=username, email=email)
        user.set_password(password)
        db.session.add(user)
        db.session.commit()
        login_user(user)
        return redirect(url_for('dashboard'))
    return render_template('auth/register.html')

@app.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('login'))

@app.route('/dashboard')
@login_required
def dashboard():
    total_images = Image.query.count()
    pending_images = Image.query.filter_by(status='Pendente').count()
    approved_images = Image.query.filter_by(status='Aprovado').count()
    rejected_images = Image.query.filter_by(status='Rejeitado').count()
    total_collections = Collection.query.count()
    total_brands = Brand.query.count()
    recent_images = Image.query.order_by(Image.upload_date.desc()).limit(5).all()
    
    return render_template('dashboard/index.html',
                          total_images=total_images,
                          pending_images=pending_images,
                          approved_images=approved_images,
                          rejected_images=rejected_images,
                          total_collections=total_collections,
                          total_brands=total_brands,
                          recent_images=recent_images)

@app.route('/catalog')
@login_required
def catalog():
    # Get filter parameters
    status_filter = request.args.getlist('status')
    collection_filter = request.args.get('collection_id')
    brand_filter = request.args.get('brand_id')
    search_query = request.args.get('q', '').strip()
    
    query = Image.query
    
    # Apply filters
    if status_filter:
        query = query.filter(Image.status.in_(status_filter))
    
    if collection_filter and collection_filter != 'all':
        query = query.filter_by(collection_id=collection_filter)
    
    if brand_filter and brand_filter != 'all':
        query = query.filter_by(brand_id=brand_filter)
    
    # Apply search if provided
    if search_query:
        search_term = f"%{search_query}%"
        query = query.filter(
            db.or_(
                Image.sku.ilike(search_term),
                Image.description.ilike(search_term),
                Image.original_name.ilike(search_term),
                Image.ai_item_type.ilike(search_term),
                Image.tags.ilike(search_term)
            )
        )
        
    images = query.order_by(Image.upload_date.desc()).all()
    
    # Get all collections and brands for the filter dropdown
    collections = Collection.query.all()
    brands = Brand.query.order_by(Brand.name).all()
    
    # Parse tags if they are stored as JSON string
    for img in images:
        if img.tags:
            try:
                img.tag_list = json.loads(img.tags)
            except:
                img.tag_list = []
        else:
            img.tag_list = []
            
    return render_template('images/catalog.html', images=images, collections=collections, brands=brands, search_query=search_query)


@app.route('/upload', methods=['GET', 'POST'])
@login_required
def upload():
    if request.method == 'POST':
        if 'image' not in request.files:
            flash('Nenhum arquivo enviado')
            return redirect(request.url)
        file = request.files['image']
        if file.filename == '':
            flash('Nenhum arquivo selecionado')
            return redirect(request.url)
        if file and file.filename.split('.')[-1].lower() in app.config['ALLOWED_EXTENSIONS']:
            filename = secure_filename(file.filename)
            # Add timestamp to filename to avoid duplicates
            timestamp = datetime.now().strftime('%Y%m%d%H%M%S')
            unique_filename = f"{timestamp}_{filename}"
            
            file_path = os.path.join(app.config['UPLOAD_FOLDER'], unique_filename)
            file.save(file_path)
            
            # Real AI Analysis with better error handling
            ai_items = []
            try:
                ai_result = analyze_image_with_ai(file_path)
                
                # Check if analysis failed (returned error message string)
                if isinstance(ai_result, str):
                    if ai_result.startswith("AI Configuration missing"):
                        print(f"[WARNING] AI not configured, using defaults")
                    else:
                        print(f"[ERROR] AI analysis failed: {ai_result}")
                    ai_items = []
                else:
                    ai_items = ai_result  # Lista de itens detectados
            except Exception as e:
                print(f"[ERROR] Exception during AI analysis: {e}")
                ai_items = []
            
            # Generate unique code
            import uuid
            unique_code = f"IMG-{uuid.uuid4().hex[:8].upper()}"
            
            # Prepare legacy fields from first item (for backward compatibility)
            first_item = ai_items[0] if ai_items else {}
            first_attrs = first_item.get('attributes', {}) if first_item else {}
            
            # Create DB record
            brand_id = request.form.get('brand_id')
            new_image = Image(
                filename=unique_filename,
                original_name=file.filename,
                collection_id=request.form.get('collection_id') if request.form.get('collection_id') else None,
                brand_id=int(brand_id) if brand_id else None,
                sku=request.form.get('sku'),
                photographer=request.form.get('photographer'),
                description=request.form.get('observations') or first_item.get('description', ''),
                tags=json.dumps(first_item.get('tags', [])) if first_item else json.dumps([]),
                ai_item_type=first_attrs.get('item_type'),
                ai_color=first_attrs.get('color'),
                ai_material=first_attrs.get('material'),
                ai_pattern=first_attrs.get('pattern'),
                ai_style=first_attrs.get('style'),
                uploader_id=current_user.id,
                unique_code=unique_code,
                status='Pendente'
            )
            db.session.add(new_image)
            db.session.flush()  # Get the image ID
            
            # Create ImageItem records for each detected piece
            for item_data in ai_items:
                attrs = item_data.get('attributes', {})
                new_item = ImageItem(
                    image_id=new_image.id,
                    item_order=item_data.get('order', 1),
                    position_ref=item_data.get('position_ref', 'Peça Única'),
                    description=item_data.get('description', ''),
                    tags=json.dumps(item_data.get('tags', [])),
                    ai_item_type=attrs.get('item_type'),
                    ai_color=attrs.get('color'),
                    ai_material=attrs.get('material'),
                    ai_pattern=attrs.get('pattern'),
                    ai_style=attrs.get('style')
                )
                db.session.add(new_item)
            
            db.session.commit()
            
            item_count = len(ai_items)
            if item_count > 1:
                flash(f'Imagem enviada com sucesso. {item_count} peças detectadas e analisadas.')
            elif item_count == 1:
                flash('Imagem enviada com sucesso. Análise de IA concluída.')
            else:
                flash('Imagem enviada com sucesso. Configure a chave OpenAI em Configurações para análise automática.')
            return redirect(url_for('catalog'))
        else:
            flash('Formato de arquivo não permitido. Use: PNG, JPG, JPEG ou GIF')
            return redirect(request.url)
    collections = Collection.query.order_by(Collection.name).all()
    brands = Brand.query.order_by(Brand.name).all()
    return render_template('images/upload.html', collections=collections, brands=brands)


@app.route('/collections')
@login_required
def collections():
    search = request.args.get('search', '')
    season = request.args.get('season', '')
    year = request.args.get('year', '')
    
    query = Collection.query
    
    if search:
        query = query.filter(Collection.name.ilike(f'%{search}%'))
    if season:
        query = query.filter_by(season=season)
    if year:
        query = query.filter_by(year=int(year))
    
    collections = query.order_by(Collection.created_at.desc()).all()
    return render_template('collections/list.html', collections=collections)

@app.route('/collections/<int:id>/edit', methods=['GET', 'POST'])
@login_required
def edit_collection(id):
    collection = Collection.query.get_or_404(id)
    
    if request.method == 'POST':
        collection.name = request.form.get('name')
        collection.description = request.form.get('description')
        collection.season = request.form.get('season')
        year = request.form.get('year')
        collection.year = int(year) if year else None
        collection.campanha = request.form.get('campanha')
        
        db.session.commit()
        flash('Coleção atualizada com sucesso!')
        return redirect(url_for('collections'))
    
    current_year = datetime.now().year
    years = list(range(current_year - 2, current_year + 3))
    return render_template('collections/edit.html', collection=collection, years=years)

@app.route('/collections/<int:id>/delete', methods=['POST'])
@login_required
def delete_collection(id):
    collection = Collection.query.get_or_404(id)
    db.session.delete(collection)
    db.session.commit()
    flash('Coleção removida com sucesso!')
    return redirect(url_for('collections'))

@app.route('/collections/new', methods=['GET', 'POST'])
@login_required
def new_collection():
    if request.method == 'POST':
        name = request.form.get('name')
        description = request.form.get('description')
        season = request.form.get('season')
        year = request.form.get('year')
        campanha = request.form.get('campanha')
        
        if not name:
            flash('Nome da coleção é obrigatório')
            return redirect(url_for('new_collection'))
            
        collection = Collection(
            name=name, 
            description=description,
            season=season,
            year=int(year) if year else None,
            campanha=campanha
        )
        db.session.add(collection)
        db.session.commit()
        
        flash('Coleção criada com sucesso!')
        return redirect(url_for('collections'))
    
    current_year = datetime.now().year
    years = list(range(current_year - 2, current_year + 3))
    return render_template('collections/new.html', years=years)


@app.route('/image/<int:id>')
@login_required
def image_detail(id):
    image = Image.query.get_or_404(id)
    try:
        image.tag_list = json.loads(image.tags) if image.tags else []
    except:
        image.tag_list = []
    
    # Process tags for each item
    for item in image.items:
        try:
            item.tag_list = json.loads(item.tags) if item.tags else []
        except:
            item.tag_list = []
    
    return render_template('images/detail.html', image=image)

@app.route('/image/<int:id>/delete', methods=['POST'])
@login_required
def delete_image(id):
    image = Image.query.get_or_404(id)
    
    try:
        file_path = os.path.join(app.config['UPLOAD_FOLDER'], image.filename)
        if os.path.exists(file_path):
            os.remove(file_path)
    except Exception as e:
        print(f"Error deleting file: {e}")
        
    db.session.delete(image)
    db.session.commit()
    
    flash('Imagem deletada com sucesso')
    return redirect(url_for('catalog'))

@app.route('/image/<int:id>/status/<status>', methods=['POST'])
@login_required
def update_image_status(id, status):
    image = Image.query.get_or_404(id)
    valid_statuses = ['Pendente', 'Aprovado', 'Rejeitado']
    if status in valid_statuses:
        image.status = status
        db.session.commit()
        flash(f'Status atualizado para {status}')
    else:
        flash('Status inválido')
    return redirect(url_for('image_detail', id=id))

@app.route('/image/<int:id>/reanalyze', methods=['POST'])
@login_required
def reanalyze_image(id):
    image = Image.query.get_or_404(id)
    
    file_path = os.path.join(app.config['UPLOAD_FOLDER'], image.filename)
    
    if not os.path.exists(file_path):
        flash('Arquivo de imagem não encontrado')
        return redirect(url_for('image_detail', id=id))
    
    try:
        ai_result = analyze_image_with_ai(file_path)
        
        # Check if analysis failed (returned error message string)
        if isinstance(ai_result, str):
            if ai_result.startswith("AI Configuration missing"):
                flash('Chave OpenAI não configurada. Acesse Configurações para adicionar.')
            else:
                flash(f'Erro na análise: {ai_result}')
            return redirect(url_for('image_detail', id=id))
        
        ai_items = ai_result  # Lista de itens detectados
        
        # Update legacy fields from first item (for backward compatibility)
        first_item = ai_items[0] if ai_items else {}
        first_attrs = first_item.get('attributes', {}) if first_item else {}
        
        image.description = first_item.get('description', '')
        image.tags = json.dumps(first_item.get('tags', [])) if first_item else json.dumps([])
        image.ai_item_type = first_attrs.get('item_type')
        image.ai_color = first_attrs.get('color')
        image.ai_material = first_attrs.get('material')
        image.ai_pattern = first_attrs.get('pattern')
        image.ai_style = first_attrs.get('style')
        
        # Remove existing items and create new ones
        ImageItem.query.filter_by(image_id=image.id).delete()
        
        for item_data in ai_items:
            attrs = item_data.get('attributes', {})
            new_item = ImageItem(
                image_id=image.id,
                item_order=item_data.get('order', 1),
                position_ref=item_data.get('position_ref', 'Peça Única'),
                description=item_data.get('description', ''),
                tags=json.dumps(item_data.get('tags', [])),
                ai_item_type=attrs.get('item_type'),
                ai_color=attrs.get('color'),
                ai_material=attrs.get('material'),
                ai_pattern=attrs.get('pattern'),
                ai_style=attrs.get('style')
            )
            db.session.add(new_item)
        
        db.session.commit()
        
        item_count = len(ai_items)
        if item_count > 1:
            flash(f'Re-análise concluída! {item_count} peças detectadas e analisadas.')
        else:
            flash('Imagem re-analisada com sucesso! Atributos atualizados.')
        
    except Exception as e:
        print(f"[ERROR] Re-analysis failed: {e}")
        flash(f'Erro ao re-analisar: {str(e)}')
    
    return redirect(url_for('image_detail', id=id))

@app.route('/image/<int:id>/edit', methods=['GET', 'POST'])
@login_required
def edit_image(id):
    image = Image.query.get_or_404(id)
    
    if request.method == 'POST':
        image.sku = request.form.get('sku')
        image.description = request.form.get('description')
        image.photographer = request.form.get('photographer')
        
        collection_id = request.form.get('collection_id')
        image.collection_id = int(collection_id) if collection_id else None
        
        brand_id = request.form.get('brand_id')
        image.brand_id = int(brand_id) if brand_id else None
        
        shooting_date = request.form.get('shooting_date')
        if shooting_date:
            try:
                image.shooting_date = datetime.strptime(shooting_date, '%Y-%m-%d')
            except ValueError:
                pass
        
        db.session.commit()
        flash('Imagem atualizada com sucesso!')
        return redirect(url_for('image_detail', id=id))
    
    collections = Collection.query.order_by(Collection.name).all()
    brands = Brand.query.order_by(Brand.name).all()
    return render_template('images/edit.html', image=image, collections=collections, brands=brands)

@app.route('/brands')
@login_required
def brands():
    brands = Brand.query.order_by(Brand.name).all()
    return render_template('brands/list.html', brands=brands)

@app.route('/brands/new', methods=['GET', 'POST'])
@login_required
def new_brand():
    if request.method == 'POST':
        name = request.form.get('name')
        description = request.form.get('description')
        
        if not name:
            flash('Nome da marca é obrigatório')
            return redirect(url_for('new_brand'))
        
        if Brand.query.filter_by(name=name).first():
            flash('Marca já existe')
            return redirect(url_for('new_brand'))
            
        brand = Brand(name=name, description=description)
        db.session.add(brand)
        db.session.commit()
        
        flash('Marca criada com sucesso!')
        return redirect(url_for('brands'))
        
    return render_template('brands/new.html')

@app.route('/analytics')
@login_required
def analytics():
    total_images = Image.query.count()
    pending_images = Image.query.filter_by(status='Pendente').count()
    approved_images = Image.query.filter_by(status='Aprovado').count()
    rejected_images = Image.query.filter_by(status='Rejeitado').count()
    total_collections = Collection.query.count()
    total_brands = Brand.query.count()
    
    return render_template('analytics/index.html', 
                          total_images=total_images,
                          pending_images=pending_images,
                          approved_images=approved_images,
                          rejected_images=rejected_images,
                          total_collections=total_collections,
                          total_brands=total_brands)

@app.route('/integrations')
@login_required
def integrations():
    return render_template('integrations/index.html')

@app.route('/settings', methods=['GET', 'POST'])
@login_required
def settings():
    if request.method == 'POST':
        api_key = request.form.get('api_key')
        
        config = SystemConfig.query.filter_by(key='OPENAI_API_KEY').first()
        if config:
            config.value = api_key
        else:
            config = SystemConfig(key='OPENAI_API_KEY', value=api_key)
            db.session.add(config)
            
        db.session.commit()
        flash('Settings updated successfully')
        return redirect(url_for('settings'))
        
    config = SystemConfig.query.filter_by(key='OPENAI_API_KEY').first()
    current_key = config.value if config else ''
    return render_template('admin/settings.html', current_key=current_key)

@app.route('/reports')
@login_required
def reports():
    total_images = Image.query.count()
    images_with_sku = Image.query.filter(Image.sku.isnot(None), Image.sku != '').count()
    images_without_sku = total_images - images_with_sku
    
    pending_images = Image.query.filter_by(status='Pendente').count()
    approved_images = Image.query.filter_by(status='Aprovado').count()
    rejected_images = Image.query.filter_by(status='Rejeitado').count()
    
    images_with_ai = Image.query.filter(Image.ai_item_type.isnot(None)).count()
    images_without_ai = total_images - images_with_ai
    
    brands = Brand.query.all()
    brands_stats = []
    for brand in brands:
        count = Image.query.filter_by(brand_id=brand.id).count()
        approved = Image.query.filter_by(brand_id=brand.id, status='Aprovado').count()
        pending = Image.query.filter_by(brand_id=brand.id, status='Pendente').count()
        brands_stats.append({
            'name': brand.name,
            'total': count,
            'approved': approved,
            'pending': pending
        })
    
    collections = Collection.query.all()
    collections_stats = []
    for collection in collections:
        count = Image.query.filter_by(collection_id=collection.id).count()
        collections_stats.append({
            'name': collection.name,
            'total': count
        })
    
    recent_uploads = Image.query.order_by(Image.upload_date.desc()).limit(10).all()
    
    return render_template('reports/index.html',
                          total_images=total_images,
                          images_with_sku=images_with_sku,
                          images_without_sku=images_without_sku,
                          pending_images=pending_images,
                          approved_images=approved_images,
                          rejected_images=rejected_images,
                          images_with_ai=images_with_ai,
                          images_without_ai=images_without_ai,
                          brands_stats=brands_stats,
                          collections_stats=collections_stats,
                          recent_uploads=recent_uploads)

@app.route('/reports/export/<report_type>')
@login_required
def export_report(report_type):
    output = io.StringIO()
    writer = csv.writer(output)
    
    if report_type == 'all':
        writer.writerow(['ID', 'Código Único', 'SKU', 'Nome Original', 'Marca', 'Coleção', 'Status', 'Tipo IA', 'Cor IA', 'Material IA', 'Fotógrafo', 'Data Upload'])
        images = Image.query.order_by(Image.upload_date.desc()).all()
        for img in images:
            writer.writerow([
                img.id,
                img.unique_code or '',
                img.sku or '',
                img.original_name,
                img.brand_ref.name if img.brand_ref else '',
                img.collection.name if img.collection else '',
                img.status,
                img.ai_item_type or '',
                img.ai_color or '',
                img.ai_material or '',
                img.photographer or '',
                img.upload_date.strftime('%Y-%m-%d %H:%M')
            ])
        filename = 'todas_imagens.csv'
        
    elif report_type == 'pending':
        writer.writerow(['ID', 'Código Único', 'SKU', 'Nome Original', 'Marca', 'Coleção', 'Data Upload'])
        images = Image.query.filter_by(status='Pendente').order_by(Image.upload_date.desc()).all()
        for img in images:
            writer.writerow([
                img.id,
                img.unique_code or '',
                img.sku or '',
                img.original_name,
                img.brand_ref.name if img.brand_ref else '',
                img.collection.name if img.collection else '',
                img.upload_date.strftime('%Y-%m-%d %H:%M')
            ])
        filename = 'imagens_pendentes.csv'
        
    elif report_type == 'without_sku':
        writer.writerow(['ID', 'Código Único', 'Nome Original', 'Marca', 'Status', 'Data Upload'])
        images = Image.query.filter(db.or_(Image.sku.is_(None), Image.sku == '')).order_by(Image.upload_date.desc()).all()
        for img in images:
            writer.writerow([
                img.id,
                img.unique_code or '',
                img.original_name,
                img.brand_ref.name if img.brand_ref else '',
                img.status,
                img.upload_date.strftime('%Y-%m-%d %H:%M')
            ])
        filename = 'imagens_sem_sku.csv'
        
    elif report_type == 'approved':
        writer.writerow(['ID', 'Código Único', 'SKU', 'Nome Original', 'Marca', 'Coleção', 'Data Upload'])
        images = Image.query.filter_by(status='Aprovado').order_by(Image.upload_date.desc()).all()
        for img in images:
            writer.writerow([
                img.id,
                img.unique_code or '',
                img.sku or '',
                img.original_name,
                img.brand_ref.name if img.brand_ref else '',
                img.collection.name if img.collection else '',
                img.upload_date.strftime('%Y-%m-%d %H:%M')
            ])
        filename = 'imagens_aprovadas.csv'
    
    elif report_type == 'without_ai':
        writer.writerow(['ID', 'Código Único', 'SKU', 'Nome Original', 'Marca', 'Status', 'Data Upload'])
        images = Image.query.filter(Image.ai_item_type.is_(None)).order_by(Image.upload_date.desc()).all()
        for img in images:
            writer.writerow([
                img.id,
                img.unique_code or '',
                img.sku or '',
                img.original_name,
                img.brand_ref.name if img.brand_ref else '',
                img.status,
                img.upload_date.strftime('%Y-%m-%d %H:%M')
            ])
        filename = 'imagens_sem_analise_ia.csv'
    
    else:
        return redirect(url_for('reports'))
    
    output.seek(0)
    response = make_response(output.getvalue())
    response.headers['Content-Disposition'] = f'attachment; filename={filename}'
    response.headers['Content-type'] = 'text/csv; charset=utf-8'
    return response

# ==================== PRODUTOS ====================

@app.route('/produtos')
@login_required
def produtos():
    search = request.args.get('search', '')
    marca_id = request.args.get('marca_id', '')
    colecao_id = request.args.get('colecao_id', '')
    status_foto = request.args.get('status_foto', '')
    
    query = Produto.query.filter_by(ativo=True)
    
    if search:
        search_term = f'%{search}%'
        query = query.filter(db.or_(
            Produto.sku.ilike(search_term),
            Produto.descricao.ilike(search_term),
            Produto.cor.ilike(search_term)
        ))
    
    if marca_id:
        query = query.filter_by(marca_id=int(marca_id))
    
    if colecao_id:
        query = query.filter_by(colecao_id=int(colecao_id))
    
    if status_foto == 'com_foto':
        query = query.filter_by(tem_foto=True)
    elif status_foto == 'sem_foto':
        query = query.filter_by(tem_foto=False)
    
    produtos_list = query.order_by(Produto.created_at.desc()).all()
    marcas = Brand.query.order_by(Brand.name).all()
    colecoes = Collection.query.order_by(Collection.name).all()
    
    # Estatísticas
    total_produtos = Produto.query.filter_by(ativo=True).count()
    com_foto = Produto.query.filter_by(ativo=True, tem_foto=True).count()
    sem_foto = Produto.query.filter_by(ativo=True, tem_foto=False).count()
    
    return render_template('produtos/list.html', 
                          produtos=produtos_list, 
                          marcas=marcas, 
                          colecoes=colecoes,
                          search_query=search,
                          total_produtos=total_produtos,
                          com_foto=com_foto,
                          sem_foto=sem_foto)

@app.route('/produtos/new', methods=['GET', 'POST'])
@login_required
def new_produto():
    if request.method == 'POST':
        sku = request.form.get('sku', '').strip()
        descricao = request.form.get('descricao', '').strip()
        cor = request.form.get('cor', '').strip()
        categoria = request.form.get('categoria', '').strip()
        atributos = request.form.get('atributos_tecnicos', '').strip()
        marca_id = request.form.get('marca_id')
        colecao_id = request.form.get('colecao_id')
        
        if not sku or not descricao:
            flash('SKU e Descrição são obrigatórios')
            return redirect(url_for('new_produto'))
        
        if Produto.query.filter_by(sku=sku).first():
            flash('SKU já cadastrado')
            return redirect(url_for('new_produto'))
        
        produto = Produto(
            sku=sku,
            descricao=descricao,
            cor=cor,
            categoria=categoria,
            atributos_tecnicos=atributos,
            marca_id=int(marca_id) if marca_id else None,
            colecao_id=int(colecao_id) if colecao_id else None
        )
        db.session.add(produto)
        db.session.commit()
        
        flash('Produto cadastrado com sucesso!')
        return redirect(url_for('produtos'))
    
    marcas = Brand.query.order_by(Brand.name).all()
    colecoes = Collection.query.order_by(Collection.name).all()
    return render_template('produtos/new.html', marcas=marcas, colecoes=colecoes)

@app.route('/produtos/<int:id>/edit', methods=['GET', 'POST'])
@login_required
def edit_produto(id):
    produto = Produto.query.get_or_404(id)
    
    if request.method == 'POST':
        sku_novo = request.form.get('sku', '').strip()
        sku_antigo = produto.sku
        motivo = request.form.get('motivo_alteracao', '').strip()
        
        # Se SKU mudou, registrar no histórico
        if sku_novo != sku_antigo:
            if not motivo:
                flash('Informe o motivo da alteração do SKU')
                return redirect(url_for('edit_produto', id=id))
            
            existing = Produto.query.filter_by(sku=sku_novo).first()
            if existing and existing.id != produto.id:
                flash('SKU já existe em outro produto')
                return redirect(url_for('edit_produto', id=id))
            
            # Registrar histórico
            historico = HistoricoSKU(
                produto_id=produto.id,
                sku_antigo=sku_antigo,
                sku_novo=sku_novo,
                motivo=motivo,
                usuario_id=current_user.id
            )
            db.session.add(historico)
            produto.sku = sku_novo
            
            # Atualizar SKU na carteira de compras se existir
            carteira_item = CarteiraCompras.query.filter_by(sku=sku_antigo).first()
            if carteira_item:
                carteira_item.sku = sku_novo
        
        produto.descricao = request.form.get('descricao', '').strip()
        produto.cor = request.form.get('cor', '').strip()
        produto.categoria = request.form.get('categoria', '').strip()
        produto.atributos_tecnicos = request.form.get('atributos_tecnicos', '').strip()
        
        marca_id = request.form.get('marca_id')
        produto.marca_id = int(marca_id) if marca_id else None
        
        colecao_id = request.form.get('colecao_id')
        produto.colecao_id = int(colecao_id) if colecao_id else None
        
        db.session.commit()
        flash('Produto atualizado com sucesso!')
        return redirect(url_for('produtos'))
    
    marcas = Brand.query.order_by(Brand.name).all()
    colecoes = Collection.query.order_by(Collection.name).all()
    
    # Imagens associadas ao produto
    imagens_associadas = Image.query.join(ImagemProduto).filter(ImagemProduto.produto_id == produto.id).all()
    
    # Imagens disponíveis para associar (não associadas ainda)
    imagens_associadas_ids = [img.id for img in imagens_associadas]
    imagens_disponiveis = Image.query.filter(~Image.id.in_(imagens_associadas_ids) if imagens_associadas_ids else True).order_by(Image.upload_date.desc()).limit(50).all()
    
    # Histórico de alterações de SKU
    historico_sku = HistoricoSKU.query.filter_by(produto_id=produto.id).order_by(HistoricoSKU.data_alteracao.desc()).all()
    
    return render_template('produtos/edit.html', 
                          produto=produto, 
                          marcas=marcas, 
                          colecoes=colecoes,
                          imagens_associadas=imagens_associadas,
                          imagens_disponiveis=imagens_disponiveis,
                          historico_sku=historico_sku)

@app.route('/produtos/<int:id>/delete', methods=['POST'])
@login_required
def delete_produto(id):
    produto = Produto.query.get_or_404(id)
    produto.ativo = False  # Soft delete
    db.session.commit()
    flash('Produto removido com sucesso')
    return redirect(url_for('produtos'))

@app.route('/produtos/export')
@login_required
def export_produtos_csv():
    output = io.StringIO()
    writer = csv.writer(output)
    writer.writerow(['SKU', 'Descrição', 'Cor', 'Categoria', 'Atributos Técnicos', 'Marca', 'Coleção', 'Tem Foto', 'Data Cadastro'])
    
    produtos = Produto.query.filter_by(ativo=True).order_by(Produto.sku).all()
    for p in produtos:
        writer.writerow([
            p.sku,
            p.descricao,
            p.cor or '',
            p.categoria or '',
            p.atributos_tecnicos or '',
            p.marca.name if p.marca else '',
            p.colecao.name if p.colecao else '',
            'Sim' if p.tem_foto else 'Não',
            p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else ''
        ])
    
    output.seek(0)
    response = make_response(output.getvalue())
    response.headers['Content-Disposition'] = 'attachment; filename=produtos.csv'
    response.headers['Content-type'] = 'text/csv; charset=utf-8'
    return response

@app.route('/produtos/<int:id>/associar-imagem', methods=['POST'])
@login_required
def associar_imagem_produto(id):
    produto = Produto.query.get_or_404(id)
    imagem_id = request.form.get('imagem_id')
    
    if not imagem_id:
        flash('Selecione uma imagem')
        return redirect(url_for('edit_produto', id=id))
    
    # Verificar se já existe associação
    existing = ImagemProduto.query.filter_by(
        imagem_id=int(imagem_id), 
        produto_id=produto.id
    ).first()
    
    if existing:
        flash('Imagem já está associada a este produto')
        return redirect(url_for('edit_produto', id=id))
    
    associacao = ImagemProduto(
        imagem_id=int(imagem_id),
        produto_id=produto.id
    )
    db.session.add(associacao)
    produto.tem_foto = True
    
    # Atualizar status na carteira se existir
    carteira_item = CarteiraCompras.query.filter_by(sku=produto.sku).first()
    if carteira_item:
        carteira_item.status_foto = 'Com Foto'
        carteira_item.produto_id = produto.id
    
    db.session.commit()
    
    flash('Imagem associada com sucesso!')
    return redirect(url_for('edit_produto', id=id))

@app.route('/produtos/<int:id>/desassociar-imagem/<int:imagem_id>', methods=['POST'])
@login_required
def desassociar_imagem_produto(id, imagem_id):
    produto = Produto.query.get_or_404(id)
    
    # Remover associação
    associacao = ImagemProduto.query.filter_by(
        imagem_id=imagem_id, 
        produto_id=produto.id
    ).first()
    
    if associacao:
        db.session.delete(associacao)
        
        # Verificar se ainda tem fotos associadas
        remaining = ImagemProduto.query.filter_by(produto_id=produto.id).count()
        if remaining == 0:
            produto.tem_foto = False
            # Atualizar status na carteira
            carteira_item = CarteiraCompras.query.filter_by(sku=produto.sku).first()
            if carteira_item:
                carteira_item.status_foto = 'Sem Foto'
        
        db.session.commit()
        flash('Imagem desassociada com sucesso!')
    else:
        flash('Associação não encontrada')
    
    return redirect(url_for('edit_produto', id=id))

# ==================== CARTEIRA DE COMPRAS ====================

@app.route('/carteira')
@login_required
def carteira():
    status = request.args.get('status', '')
    search = request.args.get('search', '')
    
    query = CarteiraCompras.query
    
    if status:
        query = query.filter_by(status_foto=status)
    
    if search:
        search_term = f'%{search}%'
        query = query.filter(db.or_(
            CarteiraCompras.sku.ilike(search_term),
            CarteiraCompras.descricao.ilike(search_term)
        ))
    
    itens = query.order_by(CarteiraCompras.data_importacao.desc()).all()
    
    # Estatísticas
    total = CarteiraCompras.query.count()
    com_foto = CarteiraCompras.query.filter_by(status_foto='Com Foto').count()
    sem_foto = CarteiraCompras.query.filter_by(status_foto='Sem Foto').count()
    pendente = CarteiraCompras.query.filter_by(status_foto='Pendente').count()
    
    return render_template('carteira/list.html', 
                          itens_carteira=itens,
                          total_carteira=total,
                          com_foto=com_foto,
                          sem_foto=sem_foto,
                          pendente=pendente,
                          search_query=search)

@app.route('/carteira/importar', methods=['GET', 'POST'])
@login_required
def importar_carteira():
    if request.method == 'POST':
        if 'arquivo' not in request.files:
            flash('Nenhum arquivo enviado')
            return redirect(request.url)
        
        file = request.files['arquivo']
        if file.filename == '':
            flash('Nenhum arquivo selecionado')
            return redirect(request.url)
        
        if not file.filename.endswith('.csv'):
            flash('Apenas arquivos CSV são permitidos')
            return redirect(request.url)
        
        try:
            # Gerar ID do lote
            import uuid
            lote_id = f"LOTE-{datetime.now().strftime('%Y%m%d%H%M%S')}-{uuid.uuid4().hex[:4].upper()}"
            
            # Ler CSV
            content = file.read().decode('utf-8')
            reader = csv.DictReader(io.StringIO(content))
            
            count = 0
            for row in reader:
                sku = row.get('sku', row.get('SKU', '')).strip()
                if not sku:
                    continue
                
                # Verificar se já existe na carteira
                existing = CarteiraCompras.query.filter_by(sku=sku).first()
                if existing:
                    # Atualizar quantidade
                    existing.quantidade = existing.quantidade + int(row.get('quantidade', row.get('QUANTIDADE', 1)) or 1)
                    existing.lote_importacao = lote_id
                else:
                    # Criar novo
                    item = CarteiraCompras(
                        sku=sku,
                        descricao=row.get('descricao', row.get('DESCRICAO', '')),
                        cor=row.get('cor', row.get('COR', '')),
                        categoria=row.get('categoria', row.get('CATEGORIA', '')),
                        quantidade=int(row.get('quantidade', row.get('QUANTIDADE', 1)) or 1),
                        lote_importacao=lote_id
                    )
                    
                    # Verificar se já tem foto
                    produto = Produto.query.filter_by(sku=sku).first()
                    if produto and produto.tem_foto:
                        item.status_foto = 'Com Foto'
                        item.produto_id = produto.id
                    else:
                        item.status_foto = 'Pendente'
                    
                    db.session.add(item)
                    count += 1
            
            db.session.commit()
            flash(f'Importação concluída! {count} novos itens adicionados. Lote: {lote_id}')
            
            # Executar cruzamento automático
            atualizar_status_carteira()
            
            return redirect(url_for('carteira'))
            
        except Exception as e:
            flash(f'Erro ao importar: {str(e)}')
            return redirect(request.url)
    
    return render_template('carteira/importar.html')

@app.route('/carteira/cruzar')
@login_required
def cruzar_carteira():
    """Executa cruzamento entre carteira e produtos/imagens"""
    count = atualizar_status_carteira()
    flash(f'Cruzamento concluído! {count} itens atualizados.')
    return redirect(url_for('carteira'))

def atualizar_status_carteira():
    """Atualiza status de fotos na carteira com base em produtos e imagens"""
    count = 0
    itens = CarteiraCompras.query.all()
    
    for item in itens:
        # Buscar produto pelo SKU
        produto = Produto.query.filter_by(sku=item.sku).first()
        
        if produto:
            item.produto_id = produto.id
            if produto.tem_foto:
                item.status_foto = 'Com Foto'
            else:
                item.status_foto = 'Sem Foto'
            count += 1
        else:
            # Buscar imagem diretamente pelo SKU
            imagem = Image.query.filter_by(sku=item.sku).first()
            if imagem:
                item.status_foto = 'Com Foto'
                count += 1
            else:
                item.status_foto = 'Sem Foto'
    
    db.session.commit()
    return count

@app.route('/carteira/export')
@login_required
def export_carteira():
    output = io.StringIO()
    writer = csv.writer(output)
    writer.writerow(['SKU', 'Descrição', 'Cor', 'Categoria', 'Quantidade', 'Status Foto', 'Data Importação', 'Lote'])
    
    itens = CarteiraCompras.query.order_by(CarteiraCompras.data_importacao.desc()).all()
    for item in itens:
        writer.writerow([
            item.sku,
            item.descricao or '',
            item.cor or '',
            item.categoria or '',
            item.quantidade,
            item.status_foto,
            item.data_importacao.strftime('%Y-%m-%d %H:%M') if item.data_importacao else '',
            item.lote_importacao or ''
        ])
    
    output.seek(0)
    response = make_response(output.getvalue())
    response.headers['Content-Disposition'] = 'attachment; filename=carteira_compras.csv'
    response.headers['Content-type'] = 'text/csv; charset=utf-8'
    return response

# ==================== RELATÓRIOS DE AUDITORIA ====================

@app.route('/auditoria')
@login_required
def auditoria():
    # SKUs com foto vs sem foto
    produtos_com_foto = Produto.query.filter_by(tem_foto=True, ativo=True).count()
    produtos_sem_foto = Produto.query.filter_by(tem_foto=False, ativo=True).count()
    total_produtos = Produto.query.filter_by(ativo=True).count()
    
    # Carteira
    carteira_total = CarteiraCompras.query.count()
    carteira_com_foto = CarteiraCompras.query.filter_by(status_foto='Com Foto').count()
    carteira_sem_foto = CarteiraCompras.query.filter_by(status_foto='Sem Foto').count()
    carteira_pendente = CarteiraCompras.query.filter_by(status_foto='Pendente').count()
    
    # Histórico de alterações de SKU
    alteracoes_sku = HistoricoSKU.query.order_by(HistoricoSKU.data_alteracao.desc()).limit(20).all()
    total_alteracoes = HistoricoSKU.query.count()
    
    # Divergências: SKUs na carteira que mudaram
    divergencias = []
    for hist in HistoricoSKU.query.all():
        carteira_item = CarteiraCompras.query.filter_by(sku=hist.sku_antigo).first()
        if carteira_item:
            divergencias.append({
                'sku_antigo': hist.sku_antigo,
                'sku_novo': hist.sku_novo,
                'data': hist.data_alteracao,
                'produto_id': hist.produto_id,
                'carteira_id': carteira_item.id
            })
    
    # Lista de SKUs pendentes (sem foto)
    skus_pendentes = Produto.query.filter_by(tem_foto=False, ativo=True).order_by(Produto.sku).limit(50).all()
    
    return render_template('auditoria/index.html',
                          produtos_com_foto=produtos_com_foto,
                          produtos_sem_foto=produtos_sem_foto,
                          total_produtos=total_produtos,
                          carteira_total=carteira_total,
                          carteira_com_foto=carteira_com_foto,
                          carteira_sem_foto=carteira_sem_foto,
                          carteira_pendente=carteira_pendente,
                          alteracoes_sku=alteracoes_sku,
                          total_alteracoes=total_alteracoes,
                          divergencias=divergencias,
                          skus_pendentes=skus_pendentes)

@app.route('/auditoria/historico-sku')
@login_required
def historico_sku():
    historico = HistoricoSKU.query.order_by(HistoricoSKU.data_alteracao.desc()).all()
    return render_template('auditoria/historico_sku.html', historico=historico)

@app.route('/auditoria/skus-pendentes')
@login_required
def skus_pendentes():
    produtos = Produto.query.filter_by(tem_foto=False, ativo=True).order_by(Produto.sku).all()
    return render_template('auditoria/skus_pendentes.html', produtos=produtos)

@app.route('/auditoria/export/<tipo>')
@login_required
def export_auditoria(tipo):
    output = io.StringIO()
    writer = csv.writer(output)
    
    if tipo == 'skus_com_foto':
        writer.writerow(['SKU', 'Descrição', 'Cor', 'Categoria', 'Marca', 'Coleção'])
        produtos = Produto.query.filter_by(tem_foto=True, ativo=True).all()
        for p in produtos:
            writer.writerow([
                p.sku, p.descricao, p.cor or '', p.categoria or '',
                p.marca.name if p.marca else '',
                p.colecao.name if p.colecao else ''
            ])
        filename = 'skus_com_foto.csv'
    
    elif tipo == 'skus_sem_foto':
        writer.writerow(['SKU', 'Descrição', 'Cor', 'Categoria', 'Marca', 'Coleção'])
        produtos = Produto.query.filter_by(tem_foto=False, ativo=True).all()
        for p in produtos:
            writer.writerow([
                p.sku, p.descricao, p.cor or '', p.categoria or '',
                p.marca.name if p.marca else '',
                p.colecao.name if p.colecao else ''
            ])
        filename = 'skus_sem_foto.csv'
    
    elif tipo == 'historico_sku':
        writer.writerow(['SKU Antigo', 'SKU Novo', 'Data Alteração', 'Motivo', 'Usuário'])
        historico = HistoricoSKU.query.order_by(HistoricoSKU.data_alteracao.desc()).all()
        for h in historico:
            writer.writerow([
                h.sku_antigo, h.sku_novo,
                h.data_alteracao.strftime('%Y-%m-%d %H:%M'),
                h.motivo or '',
                h.usuario.username if h.usuario else ''
            ])
        filename = 'historico_alteracoes_sku.csv'
    
    elif tipo == 'divergencias':
        writer.writerow(['SKU Antigo (Carteira)', 'SKU Novo (Produto)', 'Data Alteração', 'Status'])
        for hist in HistoricoSKU.query.all():
            carteira_item = CarteiraCompras.query.filter_by(sku=hist.sku_antigo).first()
            if carteira_item:
                writer.writerow([
                    hist.sku_antigo, hist.sku_novo,
                    hist.data_alteracao.strftime('%Y-%m-%d %H:%M'),
                    'Divergência Detectada'
                ])
        filename = 'divergencias_sku.csv'
    
    else:
        return redirect(url_for('auditoria'))
    
    output.seek(0)
    response = make_response(output.getvalue())
    response.headers['Content-Disposition'] = f'attachment; filename={filename}'
    response.headers['Content-type'] = 'text/csv; charset=utf-8'
    return response

# Initialize DB
with app.app_context():
    db.create_all()
    # Create a test user if not exists
    if not User.query.filter_by(username='admin').first():
        admin = User(username='admin', email='admin@oaz.com')
        admin.set_password('admin')
        db.session.add(admin)
        db.session.commit()

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)

================================================================================
ARQUIVO: ./migrate_db.py
================================================================================
import sqlite3

def migrate():
    conn = sqlite3.connect('instance/oaz_img.db')
    cursor = conn.cursor()
    
    # Add campanha column to Collection table
    try:
        cursor.execute("ALTER TABLE collection ADD COLUMN campanha VARCHAR(100)")
        print("Successfully added 'campanha' column to 'collection' table.")
    except sqlite3.OperationalError as e:
        if 'duplicate column name' in str(e).lower():
            print("Column 'campanha' already exists in 'collection', skipping.")
        else:
            print(f"Error adding 'campanha' column: {e}")
    
    # Add new columns for AI-extracted attributes to Image table
    image_columns_to_add = [
        ('ai_item_type', 'VARCHAR(100)'),
        ('ai_color', 'VARCHAR(50)'),
        ('ai_material', 'VARCHAR(100)'),
        ('ai_pattern', 'VARCHAR(50)'),
        ('ai_style', 'VARCHAR(50)')
    ]
    
    for column_name, column_type in image_columns_to_add:
        try:
            cursor.execute(f"ALTER TABLE image ADD COLUMN {column_name} {column_type}")
            print(f"Successfully added '{column_name}' column to 'image' table.")
        except sqlite3.OperationalError as e:
            if 'duplicate column name' in str(e).lower():
                print(f"Column '{column_name}' already exists, skipping.")
            else:
                print(f"Error adding '{column_name}' column: {e}")

    # Create ImageItem table for multiple pieces per image
    try:
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS image_item (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                image_id INTEGER NOT NULL,
                item_order INTEGER DEFAULT 1,
                description TEXT,
                tags TEXT,
                ai_item_type VARCHAR(100),
                ai_color VARCHAR(50),
                ai_material VARCHAR(100),
                ai_pattern VARCHAR(50),
                ai_style VARCHAR(50),
                position_ref VARCHAR(50),
                FOREIGN KEY (image_id) REFERENCES image (id) ON DELETE CASCADE
            )
        ''')
        print("Successfully created 'image_item' table.")
    except sqlite3.OperationalError as e:
        print(f"Error creating 'image_item' table: {e}")
    
    # Create Produto table
    try:
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS produto (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                sku VARCHAR(50) UNIQUE NOT NULL,
                descricao VARCHAR(255) NOT NULL,
                cor VARCHAR(50),
                categoria VARCHAR(100),
                atributos_tecnicos TEXT,
                marca_id INTEGER,
                colecao_id INTEGER,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                tem_foto BOOLEAN DEFAULT 0,
                ativo BOOLEAN DEFAULT 1,
                FOREIGN KEY (marca_id) REFERENCES brand (id),
                FOREIGN KEY (colecao_id) REFERENCES collection (id)
            )
        ''')
        print("Successfully created 'produto' table.")
    except sqlite3.OperationalError as e:
        print(f"Error creating 'produto' table: {e}")
    
    # Create ImagemProduto table (association between Image and Produto)
    try:
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS imagem_produto (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                imagem_id INTEGER NOT NULL,
                produto_id INTEGER NOT NULL,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (imagem_id) REFERENCES image (id) ON DELETE CASCADE,
                FOREIGN KEY (produto_id) REFERENCES produto (id) ON DELETE CASCADE
            )
        ''')
        print("Successfully created 'imagem_produto' table.")
    except sqlite3.OperationalError as e:
        print(f"Error creating 'imagem_produto' table: {e}")
    
    # Create HistoricoSKU table
    try:
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS historico_sku (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                produto_id INTEGER NOT NULL,
                sku_antigo VARCHAR(50) NOT NULL,
                sku_novo VARCHAR(50) NOT NULL,
                data_alteracao DATETIME DEFAULT CURRENT_TIMESTAMP,
                motivo VARCHAR(255),
                usuario_id INTEGER,
                FOREIGN KEY (produto_id) REFERENCES produto (id),
                FOREIGN KEY (usuario_id) REFERENCES user (id)
            )
        ''')
        print("Successfully created 'historico_sku' table.")
    except sqlite3.OperationalError as e:
        print(f"Error creating 'historico_sku' table: {e}")
    
    # Create CarteiraCompras table
    try:
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS carteira_compras (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                sku VARCHAR(50) NOT NULL,
                descricao VARCHAR(255),
                cor VARCHAR(50),
                categoria VARCHAR(100),
                quantidade INTEGER DEFAULT 1,
                status_foto VARCHAR(20) DEFAULT 'Pendente',
                produto_id INTEGER,
                data_importacao DATETIME DEFAULT CURRENT_TIMESTAMP,
                lote_importacao VARCHAR(50),
                FOREIGN KEY (produto_id) REFERENCES produto (id)
            )
        ''')
        print("Successfully created 'carteira_compras' table.")
    except sqlite3.OperationalError as e:
        print(f"Error creating 'carteira_compras' table: {e}")
    
    # Create indexes for faster queries
    indexes = [
        ('idx_image_item_image_id', 'image_item', 'image_id'),
        ('idx_produto_sku', 'produto', 'sku'),
        ('idx_produto_marca', 'produto', 'marca_id'),
        ('idx_produto_colecao', 'produto', 'colecao_id'),
        ('idx_imagem_produto_imagem', 'imagem_produto', 'imagem_id'),
        ('idx_imagem_produto_produto', 'imagem_produto', 'produto_id'),
        ('idx_historico_sku_produto', 'historico_sku', 'produto_id'),
        ('idx_carteira_sku', 'carteira_compras', 'sku'),
        ('idx_carteira_status', 'carteira_compras', 'status_foto'),
    ]
    
    for idx_name, table, column in indexes:
        try:
            cursor.execute(f'CREATE INDEX IF NOT EXISTS {idx_name} ON {table}({column})')
            print(f"Successfully created index '{idx_name}'.")
        except sqlite3.OperationalError as e:
            print(f"Error creating index '{idx_name}': {e}")

    conn.commit()
    conn.close()
    print("\n✅ Migration completed successfully!")

if __name__ == '__main__':
    migrate()

================================================================================
ARQUIVO: ./README.md
================================================================================
# OAZ Smart Image Bank

## Overview
This is a Flask-based Intelligent Image Bank application designed for OAZ. It features a premium dark mode design, user authentication, image cataloging, and mock AI integration for automatic description generation.

## Features
- **User Management**: Secure Login and Registration.
- **Dashboard**: Overview of stats and charts.
- **Image Catalog**: Grid view with filtering options.
- **Smart Upload**: Drag & drop interface with AI-powered description generation (mocked).
- **Collections**: Manage image collections.
- **Premium UI**: Dark mode with glassmorphism effects.

## Setup

1. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Run the Application**:
   ```bash
   python3 app.py
   ```
   The app will run on `http://127.0.0.1:5001`.

3. **Login**:
   - **Username**: `admin`
   - **Password**: `admin`
   (Or register a new account)

## Project Structure
- `app.py`: Main application logic and database models.
- `templates/`: HTML templates.
- `static/`: CSS, JS, and uploaded images.
- `instance/`: Database file (SQLite).

## Technologies
- Flask
- SQLite (SQLAlchemy)
- Chart.js
- Vanilla CSS (Custom Design System)

================================================================================
ARQUIVO: ./replit.md
================================================================================
# OAZ Smart Image Bank

## Overview
OAZ Smart Image Bank is a Flask-based intelligent image management system designed for fashion retail. It provides a professional image cataloging platform with AI-powered analysis, user authentication, and a modern dark-mode interface.

## Current State
The project has been successfully configured to run in the Replit environment. The application is fully functional with:
- User authentication system (login/register)
- Image upload and cataloging with AI-powered analysis
- Brand and Collection management
- Workflow de status (Pendente → Aprovado/Rejeitado)
- Image editing with metadata management
- Reports with CSV export
- Premium dark-mode UI with glassmorphism effects
- SQLite database with pre-configured admin user

## Project Architecture

### Tech Stack
- **Backend**: Flask (Python 3.11)
- **Database**: SQLite with SQLAlchemy ORM
- **Authentication**: Flask-Login with password hashing
- **AI Integration**: OpenAI GPT-4o Vision API
- **Frontend**: Vanilla HTML/CSS/JavaScript with custom design system

### Project Structure
```
.
├── app.py                  # Main Flask application
├── requirements.txt        # Python dependencies
├── instance/
│   └── oaz_img.db         # SQLite database
├── static/
│   ├── css/
│   │   └── style.css      # Premium dark-mode styles
│   └── uploads/           # User-uploaded images
├── templates/
│   ├── base.html          # Base template
│   ├── auth/              # Login and registration
│   ├── dashboard/         # Main dashboard
│   ├── images/            # Image catalog, upload, edit, detail
│   ├── collections/       # Collection management
│   ├── brands/            # Brand management
│   ├── reports/           # Reports and exports
│   ├── analytics/         # Analytics views
│   ├── integrations/      # Integration settings
│   └── admin/             # Admin settings
├── migrate_db.py          # Database migration utility
└── reset_admin.py         # Admin user reset utility
```

### Database Models
- **User**: User accounts with authentication
- **SystemConfig**: System-wide configuration (API keys, etc.)
- **Brand**: Product brands
- **Collection**: Image collections/groups
- **Image**: Image records with AI-extracted metadata, brand_id, photographer, shooting_date, unique_code
- **ImageItem**: Individual pieces detected in an image (supports multiple pieces per photo)
- **Produto**: Product catalog with SKU, description, color, category, technical attributes
- **ImagemProduto**: Many-to-many relationship between images and products
- **HistoricoSKU**: SKU change history with versioning and user tracking
- **CarteiraCompras**: Shopping cart/purchase order import from CSV with photo status tracking

### Key Features
1. **Smart Upload**: Drag-and-drop interface with automatic AI analysis
2. **AI Image Analysis**: Extracts product attributes (type, color, material, pattern, style)
3. **Portuguese Language**: All AI descriptions and UI text in Brazilian Portuguese
4. **Brand Management**: Create, edit, and delete brands
5. **Collection Management**: Organize images into collections
6. **Status Workflow**: Approve or reject images (Pendente → Aprovado/Rejeitado)
7. **Image Editing**: Edit SKU, description, brand, collection, photographer, shooting date
8. **Advanced Filtering**: Filter by status, collection, brand, and search by SKU/description/tags
9. **Reports**: Metrics by status, brand, collection with CSV export
10. **SEO-Ready**: AI-generated descriptions and keywords
11. **Product Catalog (Produtos)**: Full CRUD for products with SKU, description, color, category, technical attributes
12. **Image-Product Association**: Link multiple images to products and vice-versa
13. **SKU History Tracking**: Version control for SKU changes with user audit trail
14. **Shopping Cart Import (Carteira de Compras)**: Periodic CSV import with automatic photo status matching
15. **Audit Reports**: Cross-reference products vs images vs shopping cart, divergence detection

## Configuration

### Environment Setup
The application is configured to run on:
- **Host**: 0.0.0.0 (required for Replit)
- **Port**: 5000 (frontend)
- **Debug Mode**: Enabled in development

### Default Credentials
- **Username**: admin
- **Password**: admin

⚠️ Change these credentials in production!

### OpenAI Integration
To enable AI-powered image analysis:
1. Log in to the application
2. Navigate to Settings (Configurações)
3. Enter your OpenAI API Key
4. The key is stored in the database for persistence

Without an API key, images will still upload but won't have automatic analysis.

## Deployment
The project is configured with:
- **Deployment Type**: Autoscale (stateless web application)
- **Run Command**: `python app.py`
- Port 5000 is automatically exposed for web traffic

## Development Workflow

### Running Locally
The workflow "Flask App" is configured to run the application automatically. It will:
1. Start the Flask development server
2. Initialize the database if needed
3. Create the admin user if it doesn't exist
4. Listen on port 5000

### Database Management
- Database auto-initializes on first run
- Use `migrate_db.py` for schema migrations
- Use `reset_admin.py` to reset admin credentials

### Static Files
- Uploaded images are stored in `static/uploads/`
- Filenames are timestamped to prevent conflicts
- Supported formats: PNG, JPG, JPEG, GIF

## Recent Changes
- **2025-12-02**: Full Product Management & Audit System
  - New Produto model for product catalog (SKU, description, color, category, technical attributes)
  - ImagemProduto model for many-to-many image-product relationships
  - HistoricoSKU model for SKU change versioning with user tracking
  - CarteiraCompras model for shopping cart CSV import with photo status tracking
  - Full CRUD routes for products (/produtos, /produtos/new, /produtos/{id}/edit)
  - Shopping cart management (/carteira, /carteira/importar)
  - Audit dashboard (/auditoria) with SKU history, divergences, pending SKUs reports
  - CSV export for all audit reports
  - Updated sidebar with 3 new sections: Produtos, Carteira de Compras, Auditoria
  - Database migration with 5 new tables and 8 indexes

- **2025-12-02**: Multi-Piece Detection Feature
  - New ImageItem model for storing individual pieces detected in images
  - AI prompt updated to detect and analyze multiple pieces per image (up to 4)
  - Position reference for each piece (Peça Superior, Peça Inferior, Peça Única, Acessório, Calçado)
  - Separate metadata, tags, and descriptions for each detected piece
  - Updated detail page UI to display multiple pieces with cards
  - Re-analyze button updates all pieces with new detection
  - Backward compatible with existing single-piece images

- **2025-12-02**: AI Analysis Major Upgrade
  - Comprehensive material identification (30+ fabric types with visual characteristics)
  - Added transparent fabrics: Tule, Organza, Chiffon, Voal, Renda
  - Added structured fabrics: Crepe, Gabardine, Sarja, Cetim, Veludo
  - Added knits: Tricô, Moletom, Ribana/Canelada
  - Generic tag filtering (removes "casual", "moda casual", etc.)
  - Ultra-detailed descriptions for SKU verification
  - Specific style categories (avoiding generic "casual")

- **2025-12-01**: Full feature implementation
  - Added image editing page (/image/{id}/edit)
  - Created reports page with metrics and statistics
  - Implemented CSV export for all report types
  - Added brand management system (CRUD)
  - Added status workflow (Pendente → Aprovado/Rejeitado)
  - Implemented advanced filtering (by brand, collection, status, search)
  - Updated dashboard with real database data
  - Added new fields to images (brand_id, photographer, shooting_date, unique_code)

- **2025-12-01**: Initial Replit setup
  - Moved project files to root directory
  - Updated Flask configuration for Replit (host 0.0.0.0, port 5000)
  - Installed Python 3.11 and dependencies
  - Created .gitignore for Python projects
  - Configured deployment as autoscale
  - Initialized database with admin user

## User Preferences
- Interface em português brasileiro

## Tutorial Completo
Consulte o arquivo **TUTORIAL_COMPLETO.md** para um guia passo a passo detalhado de todas as funcionalidades do sistema, incluindo:
- Fluxo de trabalho completo
- Exemplos de dados para teste
- Formato de arquivos CSV para importação
- Solução de problemas

## Notes
- The application uses Flask's built-in development server
- For production, consider using a production WSGI server like Gunicorn
- Database is SQLite (suitable for development; consider PostgreSQL for production)
- All file paths are relative to the project root

================================================================================
ARQUIVO: ./requirements.txt
================================================================================
Flask
Flask-SQLAlchemy
Flask-Login
werkzeug
openai
python-dotenv

================================================================================
ARQUIVO: ./reset_admin.py
================================================================================
from app import app, db, User

with app.app_context():
    # Delete existing admin user
    admin = User.query.filter_by(username='admin').first()
    if admin:
        db.session.delete(admin)
        db.session.commit()
        print("Deleted existing admin user")
    
    # Create new admin user
    new_admin = User(username='admin', email='admin@oaz.com')
    new_admin.set_password('admin')
    db.session.add(new_admin)
    db.session.commit()
    print("Created new admin user")
    
    # Verify
    test_admin = User.query.filter_by(username='admin').first()
    if test_admin:
        print(f"Verification - User: {test_admin.username}")
        print(f"Password check: {test_admin.check_password('admin')}")

================================================================================
ARQUIVO: ./TUTORIAL_COMPLETO.md
================================================================================
# Tutorial Completo - OAZ Smart Image Bank

## Guia Passo a Passo para Testar Todas as Funcionalidades

---

## ANTES DE COMEÇAR

### Credenciais de Acesso
- **Usuário:** admin
- **Senha:** admin

### Requisitos para Análise IA
Para usar a análise automática de imagens, você precisa de uma chave de API da OpenAI. Sem ela, as imagens serão salvas mas sem análise automática.

---

## PARTE 1: LOGIN E PRIMEIRO ACESSO

### Passo 1.1 - Acessar o Sistema
1. Abra o aplicativo (clique em "Open website" ou acesse a URL do projeto)
2. Você verá a tela de login

### Passo 1.2 - Fazer Login
1. No campo **Usuário**, digite: `admin`
2. No campo **Senha**, digite: `admin`
3. Clique no botão **Entrar**
4. Você será redirecionado para o **Painel Principal (Dashboard)**

---

## PARTE 2: CONHECENDO O PAINEL PRINCIPAL

### O que você verá no Dashboard:
- **Estatísticas gerais:** Total de imagens, aprovadas, pendentes, rejeitadas
- **Imagens recentes:** Miniaturas das últimas imagens cadastradas
- **Atividade recente:** Log das últimas ações no sistema

### Navegação pela Sidebar (Menu Lateral):
A barra lateral contém todos os módulos do sistema:

| Ícone | Menu | Função |
|-------|------|--------|
| 📊 | Painel | Dashboard com estatísticas |
| 🖼️ | Biblioteca | Catálogo de todas as imagens |
| ⬆️ | Upload | Enviar novas imagens |
| 🏷️ | Coleções | Gerenciar coleções |
| 🏢 | Marcas | Gerenciar marcas |
| 📦 | Produtos | Cadastro de produtos (SKU) |
| 🛒 | Carteira | Carteira de compras |
| 🔍 | Auditoria | Relatórios de auditoria |
| 📈 | Relatórios | Métricas e exportações |
| ⚙️ | Configurações | API Key e configurações |

---

## PARTE 3: CONFIGURAR API OPENAI (OPCIONAL, MAS RECOMENDADO)

### Passo 3.1 - Acessar Configurações
1. No menu lateral, clique em **Configurações** (ícone de engrenagem)

### Passo 3.2 - Inserir Chave API
1. No campo **Chave da API OpenAI**, cole sua chave (começa com `sk-...`)
2. Clique em **Salvar Configurações**
3. Uma mensagem de sucesso aparecerá

> **Nota:** Sem a chave, o upload de imagens funcionará, mas não terá análise automática de IA.

---

## PARTE 4: CRIAR MARCAS

### Por que criar marcas primeiro?
As marcas são usadas para categorizar imagens e produtos. Crie-as antes de fazer uploads.

### Passo 4.1 - Acessar Marcas
1. No menu lateral, clique em **Marcas**

### Passo 4.2 - Criar Nova Marca
1. Clique no botão **+ Nova Marca** (canto superior direito)
2. Preencha os campos:
   - **Nome:** Ex: `OAZ Fashion`
   - **Descrição:** Ex: `Marca principal de moda feminina`
3. Clique em **Salvar**

### Sugestão de Marcas para Teste:
| Nome | Descrição |
|------|-----------|
| OAZ Fashion | Marca principal de moda feminina |
| OAZ Premium | Linha premium e luxo |
| OAZ Basic | Linha básica e casual |

### Passo 4.3 - Editar/Excluir Marca
- Para **editar**: clique no ícone de lápis ao lado da marca
- Para **excluir**: clique no ícone de lixeira (só funciona se não houver produtos vinculados)

---

## PARTE 5: CRIAR COLEÇÕES

### Por que criar coleções?
Coleções organizam as imagens por temporada, campanha ou tema.

### Passo 5.1 - Acessar Coleções
1. No menu lateral, clique em **Coleções**

### Passo 5.2 - Criar Nova Coleção
1. Clique no botão **+ Nova Coleção**
2. Preencha os campos:
   - **Nome:** Ex: `Verão 2025`
   - **Ano:** Ex: `2025`
   - **Estação:** Selecione uma opção (Primavera/Verão, Outono/Inverno, etc.)
   - **Campanha:** Ex: `Lançamento Verão`
   - **Descrição:** Ex: `Coleção de verão com peças leves e coloridas`
3. Clique em **Salvar**

### Sugestão de Coleções para Teste:
| Nome | Ano | Estação | Campanha |
|------|-----|---------|----------|
| Verão 2025 | 2025 | Primavera/Verão | Lançamento Verão |
| Inverno 2025 | 2025 | Outono/Inverno | Alto Inverno |
| Basics 2025 | 2025 | Atemporal | Coleção Permanente |

---

## PARTE 6: UPLOAD DE IMAGENS

### Passo 6.1 - Acessar Upload
1. No menu lateral, clique em **Upload**

### Passo 6.2 - Selecionar Imagem
1. Clique na área de upload (retângulo com linha pontilhada)
2. OU arraste uma imagem para a área
3. Formatos aceitos: **PNG, JPG, JPEG, GIF**
4. A prévia da imagem aparecerá

### Passo 6.3 - Preencher Metadados
Antes de enviar, preencha os campos opcionais:
- **Coleção:** Selecione uma coleção criada anteriormente
- **Marca:** Selecione uma marca
- **Fotógrafo:** Ex: `João Silva`
- **Data do Shooting:** Selecione a data da sessão de fotos

### Passo 6.4 - Enviar
1. Clique no botão **Enviar Imagem**
2. Aguarde o processamento (pode levar alguns segundos se a IA estiver ativa)
3. Você será redirecionado para a página de detalhes da imagem

### O que a IA analisa automaticamente:
- Tipo de peça (vestido, blusa, calça, etc.)
- Cores predominantes
- Material/tecido
- Padrões e estampas
- Estilo (casual, formal, esportivo)
- Tags para SEO
- Descrição detalhada em português

---

## PARTE 7: CATÁLOGO DE IMAGENS (BIBLIOTECA)

### Passo 7.1 - Acessar Biblioteca
1. No menu lateral, clique em **Biblioteca** (ou Biblioteca de Imagens)

### Passo 7.2 - Visualizar Imagens
- Você verá um grid com todas as imagens cadastradas
- Cada card mostra: miniatura, SKU, status (Pendente/Aprovado/Rejeitado)

### Passo 7.3 - Usar Filtros
Na barra superior, você pode filtrar por:
- **Busca:** Digite parte do SKU ou descrição
- **Status:** Todos, Pendente, Aprovado, Rejeitado
- **Coleção:** Selecione uma coleção específica
- **Marca:** Selecione uma marca específica

Clique em **Filtrar** para aplicar.

### Passo 7.4 - Ver Detalhes
1. Clique em qualquer imagem
2. Você verá a página de detalhes com:
   - Imagem em tamanho maior
   - Todas as informações extraídas pela IA
   - Peças detectadas (se houver múltiplas)
   - Botões de ação

### Passo 7.5 - Aprovar ou Rejeitar Imagem
Na página de detalhes:
1. Para **aprovar**: clique no botão verde **Aprovar**
2. Para **rejeitar**: clique no botão vermelho **Rejeitar**
3. O status mudará automaticamente

### Passo 7.6 - Re-analisar com IA
Se quiser uma nova análise:
1. Na página de detalhes, clique em **Re-analisar com IA**
2. Aguarde o processamento
3. Os dados serão atualizados

---

## PARTE 8: EDITAR IMAGEM

### Passo 8.1 - Acessar Edição
1. Na página de detalhes da imagem, clique em **Editar**
2. OU na biblioteca, clique no ícone de lápis da imagem

### Passo 8.2 - Campos Editáveis
Você pode editar:
- **SKU:** Código único do produto
- **Descrição:** Descrição detalhada
- **Coleção:** Vincular a outra coleção
- **Marca:** Vincular a outra marca
- **Fotógrafo:** Nome do fotógrafo
- **Data do Shooting:** Data da sessão
- **Status:** Pendente, Aprovado ou Rejeitado

### Passo 8.3 - Salvar
1. Faça as alterações desejadas
2. Clique em **Salvar Alterações**
3. Você será redirecionado para a página de detalhes

---

## PARTE 9: CADASTRO DE PRODUTOS

### O que são Produtos?
Produtos são itens com SKU único que podem ter uma ou mais imagens associadas. Diferente das imagens, produtos contêm informações comerciais.

### Passo 9.1 - Acessar Produtos
1. No menu lateral, clique em **Produtos**

### Passo 9.2 - Criar Novo Produto
1. Clique no botão **+ Novo Produto**
2. Preencha os campos:

| Campo | Exemplo | Obrigatório |
|-------|---------|-------------|
| SKU | OAZ-VES-001 | Sim |
| Descrição | Vestido longo estampado | Sim |
| Cor | Azul Marinho | Não |
| Categoria | Vestidos | Não |
| Marca | OAZ Fashion | Não |
| Coleção | Verão 2025 | Não |
| Atributos Técnicos | Tecido: Viscose, Forro: Sim | Não |

3. Clique em **Salvar**

### Sugestão de Produtos para Teste:
```
SKU: OAZ-VES-001
Descrição: Vestido longo floral
Cor: Azul com flores
Categoria: Vestidos
Atributos: Tecido: Viscose, Comprimento: Longo, Decote: V

SKU: OAZ-BLU-002
Descrição: Blusa manga bufante
Cor: Branco
Categoria: Blusas
Atributos: Tecido: Algodão, Manga: Bufante, Gola: Redonda

SKU: OAZ-CAL-003
Descrição: Calça wide leg
Cor: Preto
Categoria: Calças
Atributos: Tecido: Alfaiataria, Cintura: Alta, Modelagem: Wide
```

### Passo 9.3 - Buscar Produtos
- Use o campo de busca para pesquisar por SKU, descrição, cor ou categoria
- Clique em **Buscar**

### Passo 9.4 - Filtrar por Status de Foto
- Use o filtro **Status de Foto** para ver:
  - Todos
  - Com Foto
  - Sem Foto

### Passo 9.5 - Exportar Produtos
- Clique no botão **Exportar CSV** para baixar uma planilha com todos os produtos

---

## PARTE 10: CARTEIRA DE COMPRAS

### O que é a Carteira de Compras?
É uma lista de SKUs importados de um arquivo CSV que representa os produtos planejados para compra. O sistema cruza automaticamente com as imagens existentes.

### Passo 10.1 - Acessar Carteira
1. No menu lateral, clique em **Carteira de Compras**

### Passo 10.2 - Importar CSV

#### Formato do Arquivo CSV:
O arquivo deve ter estas colunas (separadas por vírgula ou ponto-e-vírgula):

```csv
sku,descricao,quantidade,data_entrega,fornecedor
OAZ-VES-001,Vestido longo floral,50,2025-03-15,Fornecedor A
OAZ-BLU-002,Blusa manga bufante,100,2025-03-20,Fornecedor B
OAZ-CAL-003,Calça wide leg,80,2025-03-25,Fornecedor C
OAZ-SAI-004,Saia midi plissada,60,2025-04-01,Fornecedor A
OAZ-JAQ-005,Jaqueta jeans,40,2025-04-10,Fornecedor D
```

#### Para Importar:
1. Clique no botão **Importar CSV**
2. Clique em **Escolher Arquivo** e selecione seu CSV
3. Clique em **Importar**
4. O sistema processará e mostrará quantos registros foram importados

### Passo 10.3 - Visualizar Carteira
Após importar, você verá:
- Lista de todos os SKUs da carteira
- **Status de Foto:** Com Foto (verde), Sem Foto (vermelho), Pendente (amarelo)
- O status é atualizado automaticamente baseado nas imagens existentes

### Passo 10.4 - Cruzar com Imagens
1. Clique no botão **Cruzar com Imagens**
2. O sistema verifica quais SKUs da carteira já possuem fotos
3. Os status são atualizados automaticamente

### Passo 10.5 - Filtrar Carteira
Use os filtros para ver:
- Todos os itens
- Apenas **Com Foto**
- Apenas **Sem Foto**
- Apenas **Pendente**

---

## PARTE 11: AUDITORIA

### Passo 11.1 - Acessar Auditoria
1. No menu lateral, clique em **Auditoria**

### O que você verá:

#### Seção 1: Status dos Produtos
- **Total de Produtos:** Quantidade total cadastrada
- **Produtos com Foto:** Quantidade que tem imagem vinculada (verde)
- **Produtos sem Foto:** Quantidade pendente de foto (vermelho)

#### Seção 2: Status da Carteira
- **Total na Carteira:** Itens importados
- **Com Foto:** SKUs que já possuem imagem
- **Sem Foto:** SKUs que precisam de foto
- **Pendente:** Aguardando verificação

#### Seção 3: Alterações de SKU
- Histórico das últimas mudanças de nomenclatura de SKU
- Mostra: SKU antigo → SKU novo → Data

#### Seção 4: Divergências
- SKUs na carteira que foram alterados no cadastro de produtos
- Indica inconsistências entre carteira e cadastro atual

#### Seção 5: SKUs Pendentes
- Lista de produtos sem foto
- Permite ver a lista completa ou exportar CSV

### Passo 11.2 - Exportar Relatórios
Clique nos botões de exportação:
- **Exportar lista** (Produtos com foto)
- **Exportar CSV** (SKUs pendentes)
- **Ver histórico completo** (Alterações de SKU)

### Passo 11.3 - Ver SKUs Pendentes
1. Clique em **Ver Todos** na seção de SKUs Pendentes
2. Você verá a lista completa de produtos sem foto
3. Use para priorizar os próximos shootings

---

## PARTE 12: RELATÓRIOS

### Passo 12.1 - Acessar Relatórios
1. No menu lateral, clique em **Relatórios**

### O que você verá:

#### Métricas Gerais
- Total de imagens
- Distribuição por status (gráfico)
- Imagens por coleção
- Imagens por marca

#### Exportações Disponíveis
- **Exportar Todas as Imagens (CSV)**
- **Exportar por Status (CSV)**
- **Exportar por Coleção (CSV)**

### Passo 12.2 - Exportar CSV
1. Escolha o tipo de exportação desejado
2. Clique no botão correspondente
3. O download começará automaticamente

---

## PARTE 13: FLUXO DE TRABALHO COMPLETO (EXEMPLO PRÁTICO)

### Cenário: Nova Coleção Verão 2025

#### Dia 1: Preparação
1. Login no sistema
2. Configurar API OpenAI (se ainda não fez)
3. Criar Marca: "OAZ Fashion"
4. Criar Coleção: "Verão 2025" (Ano: 2025, Estação: Primavera/Verão)

#### Dia 2: Cadastro de Produtos
1. Cadastrar produtos da coleção:
   - OAZ-VES-001: Vestido longo floral
   - OAZ-BLU-002: Blusa manga bufante
   - OAZ-CAL-003: Calça wide leg
2. Importar CSV da Carteira de Compras com os SKUs planejados

#### Dia 3: Shooting de Fotos
1. Realizar sessão de fotos
2. Fazer upload das imagens no sistema
3. Vincular cada imagem ao produto/SKU correspondente
4. A IA irá analisar automaticamente cada peça

#### Dia 4: Revisão e Aprovação
1. Acessar Biblioteca de Imagens
2. Filtrar por Status: Pendente
3. Revisar cada imagem:
   - Verificar se a análise da IA está correta
   - Editar se necessário
   - Aprovar ou Rejeitar

#### Dia 5: Auditoria e Relatórios
1. Acessar Auditoria
2. Verificar quantos SKUs ainda estão sem foto
3. Exportar lista de pendentes para priorizar próximo shooting
4. Acessar Relatórios
5. Exportar relatório completo da coleção

---

## ARQUIVOS DE EXEMPLO PARA IMPORTAÇÃO

### Arquivo: carteira_exemplo.csv
```csv
sku,descricao,quantidade,data_entrega,fornecedor
OAZ-VES-001,Vestido longo floral,50,2025-03-15,Têxtil ABC
OAZ-VES-002,Vestido midi estampado,30,2025-03-15,Têxtil ABC
OAZ-BLU-001,Blusa cropped,100,2025-03-20,Confecções XYZ
OAZ-BLU-002,Blusa manga bufante,80,2025-03-20,Confecções XYZ
OAZ-CAL-001,Calça wide leg,60,2025-03-25,Jeans Master
OAZ-CAL-002,Calça skinny,70,2025-03-25,Jeans Master
OAZ-SAI-001,Saia midi plissada,40,2025-04-01,Têxtil ABC
OAZ-JAQ-001,Jaqueta jeans oversized,25,2025-04-10,Jeans Master
OAZ-MAC-001,Macacão longo,35,2025-04-10,Confecções XYZ
OAZ-SHO-001,Short alfaiataria,90,2025-03-30,Confecções XYZ
```

### Como usar este arquivo:
1. Copie o conteúdo acima
2. Cole em um editor de texto (Bloco de Notas, VS Code)
3. Salve como `carteira_exemplo.csv`
4. Importe no sistema via **Carteira > Importar CSV**

---

## DICAS E BOAS PRÁTICAS

### Nomenclatura de SKU
Sugestão de padrão:
`MARCA-CATEGORIA-NUMERO`

Exemplos:
- OAZ-VES-001 (Vestido 001)
- OAZ-BLU-002 (Blusa 002)
- OAZ-CAL-003 (Calça 003)

### Organização de Coleções
- Use o campo **Ano** para facilitar buscas futuras
- Use **Estação** para agrupar por temporada
- Use **Campanha** para identificar lançamentos específicos

### Qualidade das Imagens
Para melhor análise da IA:
- Use fundo neutro (branco ou cinza)
- Boa iluminação
- Peça centralizada
- Resolução mínima: 800x800 pixels

### Workflow de Aprovação
1. **Pendente:** Imagem recém-enviada, aguardando revisão
2. **Aprovado:** Imagem validada e pronta para uso
3. **Rejeitado:** Imagem com problemas (qualidade, erro, etc.)

---

## SOLUÇÃO DE PROBLEMAS

### Problema: IA não está analisando as imagens
**Solução:** Verifique se a API Key da OpenAI está configurada em Configurações.

### Problema: Erro ao importar CSV
**Solução:** Verifique se o arquivo está no formato correto (UTF-8) e se as colunas estão separadas por vírgula.

### Problema: Imagem não aparece após upload
**Solução:** Aguarde alguns segundos e atualize a página. Se persistir, verifique o formato da imagem (PNG, JPG, JPEG, GIF).

### Problema: Status da carteira não atualiza
**Solução:** Clique no botão "Cruzar com Imagens" para forçar a atualização.

---

## SUPORTE

Para resetar a senha do admin:
```bash
python reset_admin.py
```

Para migrar o banco de dados após atualizações:
```bash
python migrate_db.py
```

---

**Fim do Tutorial**

*OAZ Smart Image Bank - Sistema de Gerenciamento Inteligente de Imagens*

================================================================================
ARQUIVO: ./templates/base.html
================================================================================
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Imagens OAZ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-area">
                <div class="logo-icon">
                    <i class="fas fa-gem"></i>
                </div>
                <div>
                    <div style="font-weight: 700; font-size: 1.1rem;">OAZ</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">Banco de Imagens</div>
                </div>
            </div>

            <nav class="nav-menu">
                <a href="{{ url_for('dashboard') }}"
                    class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                    <i class="fas fa-th-large"></i>
                    <span>Painel</span>
                </a>
                <a href="{{ url_for('catalog') }}"
                    class="nav-item {% if request.endpoint == 'catalog' %}active{% endif %}">
                    <i class="far fa-images"></i>
                    <span>Biblioteca de Imagens</span>
                </a>
                <a href="{{ url_for('produtos') }}"
                    class="nav-item {% if request.endpoint in ['produtos', 'new_produto', 'edit_produto'] %}active{% endif %}">
                    <i class="fas fa-box"></i>
                    <span>Produtos</span>
                </a>
                <a href="{{ url_for('carteira') }}"
                    class="nav-item {% if request.endpoint in ['carteira', 'importar_carteira'] %}active{% endif %}">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Carteira de Compras</span>
                </a>
                <a href="{{ url_for('collections') }}"
                    class="nav-item {% if request.endpoint == 'collections' %}active{% endif %}">
                    <i class="far fa-folder"></i>
                    <span>Coleções</span>
                </a>
                <a href="{{ url_for('brands') }}"
                    class="nav-item {% if request.endpoint == 'brands' %}active{% endif %}">
                    <i class="fas fa-tag"></i>
                    <span>Marcas</span>
                </a>
                <a href="{{ url_for('auditoria') }}"
                    class="nav-item {% if request.endpoint in ['auditoria', 'historico_sku', 'skus_pendentes'] %}active{% endif %}">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Auditoria</span>
                </a>
                <a href="{{ url_for('reports') }}"
                    class="nav-item {% if request.endpoint == 'reports' %}active{% endif %}">
                    <i class="fas fa-file-alt"></i>
                    <span>Relatórios</span>
                </a>
                <a href="{{ url_for('integrations') }}"
                    class="nav-item {% if request.endpoint == 'integrations' %}active{% endif %}">
                    <i class="fas fa-network-wired"></i>
                    <span>Integrações</span>
                </a>
            </nav>

            <div class="bottom-menu">
                <a href="#" class="nav-item">
                    <i class="far fa-question-circle"></i>
                    <span>Ajuda</span>
                </a>
                <a href="{{ url_for('logout') }}" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Buscar por SKU, tag, coleção...">
                </div>

                <div class="header-actions">
                    <button class="icon-btn"><i class="far fa-bell"></i></button>
                    <a href="{{ url_for('settings') }}" class="icon-btn"><i class="fas fa-cog"></i></a>
                    <div class="user-profile">
                        <!-- Placeholder for user avatar -->
                        <div
                            style="width:100%; height:100%; background:#3b82f6; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">
                            {{ current_user.username[0].upper() }}
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Scroll Area -->
            <div class="content-scroll">
                {% with messages = get_flashed_messages() %}
                {% if messages %}
                <div
                    style="margin-bottom: 1rem; padding: 1rem; background: rgba(31, 111, 235, 0.1); border: 1px solid var(--accent-blue); border-radius: 6px; color: var(--accent-blue);">
                    {{ messages[0] }}
                </div>
                {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
</body>

</html>
================================================================================
ARQUIVO: ./templates/auth/login.html
================================================================================
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Banco de Imagens OAZ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="auth-container">
        <div class="auth-box">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div class="logo-icon" style="margin: 0 auto 1rem; width: 48px; height: 48px; font-size: 1.5rem;">
                    <i class="fas fa-gem"></i>
                </div>
                <h1 class="auth-title">Banco de Imagens OAZ</h1>
                <p style="color: var(--text-secondary);">Entre para acessar seu espaço de trabalho</p>
            </div>

            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div style="margin-bottom: 1rem; color: #f85149; text-align: center;">
                {{ messages[0] }}
            </div>
            {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('login') }}">
                <div class="form-group">
                    <label class="form-label">Usuário</label>
                    <input type="text" name="username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary"
                    style="width: 100%; justify-content: center; margin-top: 1rem;">
                    Entrar
                </button>
            </form>

            <div style="margin-top: 1.5rem; text-align: center; font-size: 0.9rem;">
                <a href="{{ url_for('register') }}" style="color: var(--text-secondary);">Não tem uma conta?
                    Cadastre-se</a>
            </div>
        </div>
    </div>
</body>

</html>
================================================================================
ARQUIVO: ./templates/auth/register.html
================================================================================
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Banco de Imagens OAZ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="auth-container">
        <div class="auth-box">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div class="logo-icon" style="margin: 0 auto 1rem; width: 48px; height: 48px; font-size: 1.5rem;">
                    <i class="fas fa-gem"></i>
                </div>
                <h1 class="auth-title">Criar Conta</h1>
                <p style="color: var(--text-secondary);">Junte-se ao Banco de Imagens OAZ</p>
            </div>

            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div style="margin-bottom: 1rem; color: #f85149; text-align: center;">
                {{ messages[0] }}
            </div>
            {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('register') }}">
                <div class="form-group">
                    <label class="form-label">Usuário</label>
                    <input type="text" name="username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">E-mail</label>
                    <input type="email" name="email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary"
                    style="width: 100%; justify-content: center; margin-top: 1rem;">
                    Criar Conta
                </button>
            </form>

            <div style="margin-top: 1.5rem; text-align: center; font-size: 0.9rem;">
                <a href="{{ url_for('login') }}" style="color: var(--text-secondary);">Já tem uma conta? Entre</a>
            </div>
        </div>
    </div>
</body>

</html>
================================================================================
ARQUIVO: ./templates/dashboard/index.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Painel</h1>
    <p style="color: var(--text-secondary);">Bem-vindo de volta, aqui está uma visão geral do seu banco de imagens.</p>
</div>

<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-title">Total de Imagens</div>
        <div class="stat-value">{{ total_images }}</div>
        <div style="font-size: 0.85rem; color: var(--text-secondary);">
            no sistema
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Pendentes</div>
        <div class="stat-value" style="color: #d29922;">{{ pending_images }}</div>
        <div style="font-size: 0.85rem; color: var(--text-secondary);">
            aguardando revisão
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Aprovadas</div>
        <div class="stat-value" style="color: #3fb950;">{{ approved_images }}</div>
        <div style="font-size: 0.85rem; color: var(--text-secondary);">
            prontas para uso
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Rejeitadas</div>
        <div class="stat-value" style="color: #f85149;">{{ rejected_images }}</div>
        <div style="font-size: 0.85rem; color: var(--text-secondary);">
            precisam atenção
        </div>
    </div>
</div>

<div class="charts-grid">
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div class="chart-card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                    <h3>Resumo</h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="far fa-folder" style="font-size: 1.5rem; color: var(--accent-blue);"></i>
                            <span>Coleções</span>
                        </div>
                        <strong style="font-size: 1.25rem;">{{ total_collections }}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-tag" style="font-size: 1.5rem; color: var(--accent-blue);"></i>
                            <span>Marcas</span>
                        </div>
                        <strong style="font-size: 1.25rem;">{{ total_brands }}</strong>
                    </div>
                </div>
            </div>
            <div class="chart-card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                    <h3>Distribuição por Status</h3>
                </div>
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>

    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div class="stat-card" style="padding: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="font-size: 1rem;">Imagens Recentes</h3>
                <a href="{{ url_for('catalog') }}" style="font-size: 0.85rem;">Ver todas</a>
            </div>

            {% if recent_images %}
                {% for image in recent_images %}
                <div style="display: flex; gap: 10px; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <div style="width: 40px; height: 40px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.9rem;">{{ image.sku or image.original_name[:20] }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            <span class="status-badge status-{{ image.status.lower() }}" style="font-size: 0.7rem;">{{ image.status }}</span>
                        </div>
                    </div>
                    <a href="{{ url_for('image_detail', id=image.id) }}" style="color: var(--accent-blue); font-size: 0.85rem;">
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Nenhuma imagem ainda.</p>
            {% endif %}

            <div style="text-align: center; margin-top: 1rem;">
                <a href="{{ url_for('upload') }}" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    <i class="fas fa-cloud-upload-alt"></i> Enviar Nova Imagem
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctxStatus = document.getElementById('statusChart').getContext('2d');
    new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
            labels: ['Pendente', 'Aprovado', 'Rejeitado'],
            datasets: [{
                data: [{{ pending_images }}, {{ approved_images }}, {{ rejected_images }}],
                backgroundColor: ['#d29922', '#3fb950', '#f85149'],
                borderWidth: 0
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom', labels: { color: '#9ca3af' } }
            }
        }
    });
</script>
{% endblock %}

================================================================================
ARQUIVO: ./templates/images/catalog.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Busca & Catálogo de Imagens</h1>
        <p style="color: var(--text-secondary);">Mostrando {{ images|length }} resultados</p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('upload') }}" class="btn btn-primary">
            <i class="fas fa-cloud-upload-alt"></i> Enviar Nova
        </a>
        <button class="btn"
            style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
            <i class="fas fa-file-export"></i> Exportar para CSV
        </button>
    </div>
</div>

<div style="display: flex; gap: 2rem;">
    <!-- Filters Sidebar -->
    <div style="width: 250px; flex-shrink: 0;">
        <form action="{{ url_for('catalog') }}" method="GET" style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1rem; margin-bottom: 1rem;">Filtros</h3>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Buscar</label>
                <input type="text" name="q" class="form-control" placeholder="SKU, descrição, tags..." value="{{ search_query or '' }}">
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Coleção</label>
                <select name="collection_id" class="form-control">
                    <option value="all">Todas as Coleções</option>
                    {% for collection in collections %}
                    <option value="{{ collection.id }}" {% if request.args.get('collection_id')==collection.id|string %}selected{% endif %}>
                        {{ collection.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Marca</label>
                <select name="brand_id" class="form-control">
                    <option value="all">Todas as Marcas</option>
                    {% for brand in brands %}
                    <option value="{{ brand.id }}" {% if request.args.get('brand_id')==brand.id|string %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Status</label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Aprovado" {% if 'Aprovado' in request.args.getlist('status') %}checked{% endif %}> Aprovado
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Pendente" {% if 'Pendente' in request.args.getlist('status') %}checked{% endif %}> Pendente
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Rejeitado" {% if 'Rejeitado' in request.args.getlist('status') %}checked{% endif %}> Rejeitado
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">Aplicar Filtros</button>
            <a href="{{ url_for('catalog') }}" class="btn" style="width: 100%; justify-content: center; margin-top: 0.5rem; border: 1px solid var(--border-color); color: var(--text-primary);">Limpar</a>
        </form>
    </div>

    <!-- Image Grid -->
    <div style="flex: 1;">
        <div class="image-grid">
            {% for image in images %}
            <div class="image-card">
                <div style="position: relative;">
                    <a href="{{ url_for('image_detail', id=image.id) }}">
                        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" class="image-preview"
                            alt="{{ image.original_name }}">
                    </a>
                    <div style="position: absolute; top: 8px; left: 8px;">
                        <input type="checkbox" style="transform: scale(1.2);">
                    </div>
                    <div style="position: absolute; top: 8px; right: 8px;">
                        <form action="{{ url_for('delete_image', id=image.id) }}" method="POST"
                            onsubmit="return confirm('Deletar esta imagem?');">
                            <button type="submit"
                                style="background: rgba(0,0,0,0.5); border: none; color: #f85149; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-trash-alt" style="font-size: 0.8rem;"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <div class="image-info">
                    <div class="image-title">{{ image.sku or 'Sem SKU' }}</div>
                    <div class="image-meta">{{ image.brand_ref.name if image.brand_ref else 'Sem Marca' }}</div>
                    <div class="status-badge status-{{ image.status.lower() }}">
                        {{ image.status }}
                    </div>
                    <div style="margin-top: 0.5rem; display: flex; gap: 4px; flex-wrap: wrap;">
                        {% for tag in image.tag_list[:3] %}
                        <span
                            style="font-size: 0.7rem; background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">{{
                            tag }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% else %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-secondary);">
                <i class="far fa-images" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <p>Nenhuma imagem encontrada. Envie algumas imagens para começar.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
================================================================================
ARQUIVO: ./templates/images/detail.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
        Coleções / {{ image.collection.name if image.collection else 'Sem Categoria' }} / {{ image.original_name }}
    </div>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>{{ image.original_name }}</h1>
        <div style="display: flex; gap: 1rem;">
            <a href="{{ url_for('edit_image', id=image.id) }}" class="btn" style="background: var(--accent-blue); color: white;">
                <i class="fas fa-edit"></i> Editar
            </a>
            <a href="{{ url_for('static', filename='uploads/' + image.filename) }}" download class="btn" style="background: var(--bg-tertiary); color: var(--text-primary);">
                <i class="fas fa-download"></i> Baixar
            </a>
            <button onclick="copyToClipboard('direct-url')" class="btn" style="background: var(--bg-tertiary); color: var(--text-primary);">
                <i class="fas fa-link"></i> Copiar Link
            </button>
            <form action="{{ url_for('delete_image', id=image.id) }}" method="POST" style="display: inline;"
                onsubmit="return confirm('Tem certeza que deseja deletar esta imagem? Esta ação não pode ser desfeita.');">
                <button type="submit" class="btn"
                    style="background: rgba(248, 81, 73, 0.1); color: #f85149; border: 1px solid rgba(248, 81, 73, 0.4);">
                    <i class="fas fa-trash-alt"></i> Deletar
                </button>
            </form>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
    <!-- Image View -->
    <div class="stat-card"
        style="padding: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: black; height: 600px;">
        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}"
            style="max-width: 100%; max-height: 100%; object-fit: contain;">
    </div>

    <!-- Metadata Sidebar -->
    <div class="stat-card">
        <div style="border-bottom: 1px solid var(--border-color); margin-bottom: 1rem; padding-bottom: 0.5rem;">
            <div style="display: flex; gap: 1.5rem; font-size: 0.9rem; font-weight: 500;">
                <span id="tab-metadata" class="tab-button active-tab"
                    style="cursor: pointer; padding-bottom: 6px; transition: all 0.3s; color: var(--accent-blue); border-bottom: 2px solid var(--accent-blue);"
                    onclick="switchTab('metadata')">Metadados</span>
                <span id="tab-ai" class="tab-button"
                    style="cursor: pointer; padding-bottom: 6px; transition: all 0.3s; color: var(--text-secondary); border-bottom: 2px solid transparent;"
                    onclick="switchTab('ai')">IA & Tags</span>
                <span id="tab-links" class="tab-button"
                    style="cursor: pointer; padding-bottom: 6px; transition: all 0.3s; color: var(--text-secondary); border-bottom: 2px solid transparent;"
                    onclick="switchTab('links')">Links</span>
            </div>
        </div>


        <!-- Tab Content: Metadados -->
        <div id="content-metadata" class="tab-content" style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">Nome da Coleção</span>
                <span>{{ image.collection.name if image.collection else '-' }}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">Nome da Marca</span>
                <span>{{ image.brand_ref.name if image.brand_ref else '-' }}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">SKU</span>
                <span>{{ image.sku or '-' }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-secondary);">Status</span>
                <span class="status-badge status-{{ image.status.lower() }}">{{ image.status }}</span>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                <form action="{{ url_for('update_image_status', id=image.id, status='Aprovado') }}" method="POST" style="flex: 1;">
                    <button type="submit" class="btn" style="width: 100%; background: rgba(63, 185, 80, 0.1); color: #3fb950; border: 1px solid rgba(63, 185, 80, 0.3); font-size: 0.8rem;">
                        <i class="fas fa-check"></i> Aprovar
                    </button>
                </form>
                <form action="{{ url_for('update_image_status', id=image.id, status='Rejeitado') }}" method="POST" style="flex: 1;">
                    <button type="submit" class="btn" style="width: 100%; background: rgba(248, 81, 73, 0.1); color: #f85149; border: 1px solid rgba(248, 81, 73, 0.3); font-size: 0.8rem;">
                        <i class="fas fa-times"></i> Rejeitar
                    </button>
                </form>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">Data de Upload</span>
                <span>{{ image.upload_date.strftime('%Y-%m-%d') }}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-secondary);">Enviado por</span>
                <span>{{ image.uploader_id }}</span>
            </div>

            <div style="margin-top: 1rem;">
                <span style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Observações</span>
                <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 6px; font-size: 0.9rem;">
                    {{ image.description or 'Sem observações.' }}
                </div>
            </div>

            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <h4 style="font-size: 0.95rem; margin-bottom: 1rem;">Detalhes Técnicos</h4>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem;">
                    <span style="color: var(--text-secondary);">Formato</span>
                    <span>{{ image.filename.split('.')[-1].upper() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem;">
                    <span style="color: var(--text-secondary);">Nome do Arquivo</span>
                    <span style="font-size: 0.8rem;">{{ image.filename }}</span>
                </div>
            </div>
        </div>

        <!-- Tab Content: IA & Tags -->
        <div id="content-ai" class="tab-content" style="display: none; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h4 style="font-size: 0.95rem; display: flex; align-items: center; gap: 8px; margin: 0;">
                    <i class="fas fa-magic" style="color: var(--accent-blue);"></i>
                    Análise de IA
                </h4>
                <form action="{{ url_for('reanalyze_image', id=image.id) }}" method="POST" style="margin: 0;">
                    <button type="submit" class="btn" style="background: rgba(130, 80, 223, 0.1); color: #a371f7; border: 1px solid rgba(130, 80, 223, 0.3); font-size: 0.75rem; padding: 4px 10px;"
                        onclick="this.innerHTML='<i class=\'fas fa-spinner fa-spin\'></i> Analisando...'; this.disabled=true; this.form.submit();">
                        <i class="fas fa-sync-alt"></i> Re-analisar
                    </button>
                </form>
            </div>
            
            {% if image.items and image.items|length > 0 %}
            <div style="background: rgba(130, 80, 223, 0.1); border: 1px solid rgba(130, 80, 223, 0.3); border-radius: 6px; padding: 8px 12px; margin-bottom: 0.5rem;">
                <span style="color: #a371f7; font-size: 0.85rem;">
                    <i class="fas fa-layer-group"></i> {{ image.items|length }} peça(s) detectada(s) nesta imagem
                </span>
            </div>
            
            {% for item in image.items|sort(attribute='item_order') %}
            <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 1rem; margin-bottom: 0.75rem; border-left: 3px solid var(--accent-blue);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <span style="font-weight: 600; color: var(--accent-blue); font-size: 0.9rem;">
                        <i class="fas fa-tshirt"></i> {{ item.position_ref or 'Peça ' ~ item.item_order }}
                    </span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">#{{ item.item_order }}</span>
                </div>
                
                {% if item.tag_list %}
                <div style="margin-bottom: 0.75rem;">
                    <span style="color: var(--text-secondary); display: block; font-size: 0.75rem; margin-bottom: 0.3rem;">Tags</span>
                    <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                        {% for tag in item.tag_list %}
                        <span style="font-size: 0.7rem; background: var(--bg-secondary); padding: 2px 8px; border-radius: 10px; color: var(--text-primary);">{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem;">
                    {% if item.ai_item_type %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.7rem;">Tipo</span>
                        <span style="font-weight: 500;">{{ item.ai_item_type }}</span>
                    </div>
                    {% endif %}
                    {% if item.ai_color %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.7rem;">Cor</span>
                        <span style="font-weight: 500;">{{ item.ai_color }}</span>
                    </div>
                    {% endif %}
                    {% if item.ai_material %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.7rem;">Material</span>
                        <span style="font-weight: 500;">{{ item.ai_material }}</span>
                    </div>
                    {% endif %}
                    {% if item.ai_pattern %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.7rem;">Padrão</span>
                        <span style="font-weight: 500;">{{ item.ai_pattern }}</span>
                    </div>
                    {% endif %}
                    {% if item.ai_style %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.7rem;">Estilo</span>
                        <span style="font-weight: 500;">{{ item.ai_style }}</span>
                    </div>
                    {% endif %}
                </div>
                
                {% if item.description %}
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-color);">
                    <span style="color: var(--text-secondary); display: block; font-size: 0.7rem; margin-bottom: 0.3rem;">Descrição</span>
                    <p style="font-size: 0.8rem; color: var(--text-primary); margin: 0; line-height: 1.4;">{{ item.description }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
            
            {% else %}
            <div>
                <span style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Tags IA</span>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    {% for tag in image.tag_list %}
                    <span style="font-size: 0.8rem; background: var(--bg-tertiary); padding: 4px 10px; border-radius: 12px; color: var(--text-primary);">{{ tag }}</span>
                    {% else %}
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Nenhuma tag gerada.</span>
                    {% endfor %}
                </div>
            </div>

            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <h4 style="font-size: 0.9rem; margin-bottom: 0.75rem;">Atributos Extraídos</h4>
                {% if image.ai_item_type or image.ai_color or image.ai_material or image.ai_pattern or image.ai_style %}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.9rem;">
                    {% if image.ai_item_type %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Tipo de Item</span>
                        <span style="font-weight: 500;">{{ image.ai_item_type }}</span>
                    </div>
                    {% endif %}
                    {% if image.ai_color %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Cor</span>
                        <span style="font-weight: 500;">{{ image.ai_color }}</span>
                    </div>
                    {% endif %}
                    {% if image.ai_material %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Material</span>
                        <span style="font-weight: 500;">{{ image.ai_material }}</span>
                    </div>
                    {% endif %}
                    {% if image.ai_pattern %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Padrão</span>
                        <span style="font-weight: 500;">{{ image.ai_pattern }}</span>
                    </div>
                    {% endif %}
                    {% if image.ai_style %}
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Estilo</span>
                        <span style="font-weight: 500;">{{ image.ai_style }}</span>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhum atributo IA extraído. Configure a chave OpenAI em Configurações para análise automática.</p>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Tab Content: Links -->
        <div id="content-links" class="tab-content" style="display: none; flex-direction: column; gap: 1rem;">
            <div>
                <h4 style="font-size: 0.95rem; margin-bottom: 1rem;">Links de Compartilhamento</h4>

                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">URL
                        Direta da Imagem</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="direct-url" readonly
                            value="{{ request.url_root }}static/uploads/{{ image.filename }}"
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; color: var(--text-primary); font-size: 0.85rem;">
                        <button onclick="copyToClipboard('direct-url')" class="btn"
                            style="background: var(--accent-blue); color: white;">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Link
                        para esta Página</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="page-url" readonly value="{{ request.url }}"
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; color: var(--text-primary); font-size: 0.85rem;">
                        <button onclick="copyToClipboard('page-url')" class="btn"
                            style="background: var(--accent-blue); color: white;">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Código
                        HTML para Embed</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <textarea id="html-embed" readonly rows="3"
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; color: var(--text-primary); font-size: 0.85rem; font-family: monospace; resize: vertical;">&lt;img src="{{ request.url_root }}static/uploads/{{ image.filename }}" alt="{{ image.original_name }}" /&gt;</textarea>
                        <button onclick="copyToClipboard('html-embed')" class="btn"
                            style="background: var(--accent-blue); color: white;">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>

                <div
                    style="padding: 1rem; background: rgba(31, 111, 235, 0.05); border: 1px solid rgba(31, 111, 235, 0.2); border-radius: 6px;">
                    <div
                        style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem; color: var(--accent-blue);">
                        <i class="fas fa-info-circle"></i>
                        <strong style="font-size: 0.9rem;">Dica</strong>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Você pode compartilhar estes
                        links com sua equipe ou usar o código HTML para incorporar a imagem em sites externos.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function switchTab(tabName) {
        // Hide all tab contents
        const contents = document.querySelectorAll('.tab-content');
        contents.forEach(content => {
            content.style.display = 'none';
        });

        // Remove active state from all tabs
        const tabs = document.querySelectorAll('.tab-button');
        tabs.forEach(tab => {
            tab.style.color = 'var(--text-secondary)';
            tab.style.borderBottom = '2px solid transparent';
        });

        // Show selected tab content
        const selectedContent = document.getElementById('content-' + tabName);
        if (selectedContent) {
            selectedContent.style.display = 'flex';
        }

        // Activate selected tab
        const selectedTab = document.getElementById('tab-' + tabName);
        if (selectedTab) {
            selectedTab.style.color = 'var(--accent-blue)';
            selectedTab.style.borderBottom = '2px solid var(--accent-blue)';
        }
    }

    function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        element.select();
        element.setSelectionRange(0, 99999); // For mobile devices

        navigator.clipboard.writeText(element.value).then(() => {
            // Show temporary feedback
            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
            btn.style.background = '#2da44e';

            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = 'var(--accent-blue)';
            }, 2000);
        });
    }
</script>
{% endblock %}
================================================================================
ARQUIVO: ./templates/images/edit.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
        <a href="{{ url_for('catalog') }}" style="color: var(--text-secondary); text-decoration: none;">Catálogo</a> / 
        <a href="{{ url_for('image_detail', id=image.id) }}" style="color: var(--text-secondary); text-decoration: none;">{{ image.original_name }}</a> / 
        Editar
    </div>
    <h1>Editar Imagem</h1>
</div>

<div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
    <div class="stat-card" style="padding: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: black; height: 300px;">
        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
    </div>

    <div class="stat-card">
        <form action="{{ url_for('edit_image', id=image.id) }}" method="POST">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div>
                    <label class="form-label">SKU / Código do Produto</label>
                    <input type="text" name="sku" class="form-control" value="{{ image.sku or '' }}" placeholder="Ex: CAMISA-001">
                </div>
                
                <div>
                    <label class="form-label">Código Único</label>
                    <input type="text" class="form-control" value="{{ image.unique_code or '-' }}" disabled style="background: var(--bg-tertiary); cursor: not-allowed;">
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">Gerado automaticamente</small>
                </div>
                
                <div>
                    <label class="form-label">Coleção</label>
                    <select name="collection_id" class="form-control">
                        <option value="">Sem coleção</option>
                        {% for collection in collections %}
                        <option value="{{ collection.id }}" {% if image.collection_id == collection.id %}selected{% endif %}>
                            {{ collection.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="form-label">Marca</label>
                    <select name="brand_id" class="form-control">
                        <option value="">Sem marca</option>
                        {% for brand in brands %}
                        <option value="{{ brand.id }}" {% if image.brand_id == brand.id %}selected{% endif %}>
                            {{ brand.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="form-label">Fotógrafo</label>
                    <input type="text" name="photographer" class="form-control" value="{{ image.photographer or '' }}" placeholder="Nome do fotógrafo">
                </div>
                
                <div>
                    <label class="form-label">Data do Shooting</label>
                    <input type="date" name="shooting_date" class="form-control" value="{{ image.shooting_date.strftime('%Y-%m-%d') if image.shooting_date else '' }}">
                </div>
            </div>
            
            <div style="margin-top: 1.5rem;">
                <label class="form-label">Descrição / Observações</label>
                <textarea name="description" class="form-control" rows="4" placeholder="Descrição detalhada do produto ou observações...">{{ image.description or '' }}</textarea>
            </div>
            
            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                <h4 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--text-secondary);">
                    <i class="fas fa-robot"></i> Atributos da IA (somente leitura)
                </h4>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; font-size: 0.9rem;">
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Tipo</span>
                        <span>{{ image.ai_item_type or '-' }}</span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Cor</span>
                        <span>{{ image.ai_color or '-' }}</span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Material</span>
                        <span>{{ image.ai_material or '-' }}</span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Padrão</span>
                        <span>{{ image.ai_pattern or '-' }}</span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary); display: block; font-size: 0.8rem;">Estilo</span>
                        <span>{{ image.ai_style or '-' }}</span>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                <a href="{{ url_for('image_detail', id=image.id) }}" class="btn" style="background: var(--bg-tertiary); color: var(--text-primary);">
                    <i class="fas fa-times"></i> Cancelar
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar Alterações
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/images/upload.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Enviar Nova Imagem</h1>
    <p style="color: var(--text-secondary);">Banco de Imagens / Todas as Imagens / Enviar Nova Imagem</p>
</div>

<form method="POST" enctype="multipart/form-data"
    style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; height: calc(100vh - 200px);">

    <!-- Left: Upload Area -->
    <div>
        <div class="upload-area" id="drop-zone">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <h3>Arraste e Solte Sua Imagem Aqui</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Ou, navegue pelos arquivos do seu computador
            </p>
            <input type="file" name="image" id="file-input" style="display: none;" accept="image/*">
            <button type="button" class="btn"
                style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);"
                onclick="document.getElementById('file-input').click()">
                Procurar Arquivos
            </button>
        </div>
        <div id="preview-container" style="display: none; margin-top: 1rem; text-align: center;">
            <img id="image-preview"
                style="max-height: 300px; border-radius: 8px; border: 1px solid var(--border-color);">
        </div>
    </div>

    <!-- Right: Metadata Form -->
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div class="stat-card" style="padding: 1.5rem;">
            <div class="form-group">
                <label class="form-label">Coleção *</label>
                <select name="collection_id" class="form-control">
                    <option value="">Selecione uma coleção</option>
                    {% for collection in collections %}
                    <option value="{{ collection.id }}">{{ collection.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Marca *</label>
                <select name="brand_id" class="form-control">
                    <option value="">Selecione uma marca</option>
                    {% for brand in brands %}
                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">SKU (Opcional)</label>
                <input type="text" name="sku" class="form-control" placeholder="ex: ABC-12345">
            </div>

            <div class="form-group">
                <label class="form-label">Fotógrafo (Opcional)</label>
                <input type="text" name="photographer" class="form-control" placeholder="Nome do fotógrafo">
            </div>

            <div class="form-group">
                <label class="form-label">Observações</label>
                <textarea name="observations" class="form-control" rows="3" placeholder="Adicione notas..."></textarea>
            </div>
        </div>

        <!-- AI Suggestions Mockup -->
        <div class="stat-card"
            style="padding: 1.5rem; background: rgba(31, 111, 235, 0.05); border-color: rgba(31, 111, 235, 0.2);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 1rem; color: var(--accent-blue);">
                <i class="fas fa-magic"></i>
                <h3 style="font-size: 1rem; margin: 0;">Sugestões com IA</h3>
            </div>

            <div style="margin-bottom: 1rem;">
                <label class="form-label" style="font-size: 0.8rem;">Descrição IA</label>
                <div
                    style="background: var(--bg-tertiary); padding: 10px; border-radius: 6px; font-size: 0.85rem; color: var(--text-secondary); font-style: italic;">
                    Envie uma imagem para gerar uma descrição...
                </div>
            </div>

            <div>
                <label class="form-label" style="font-size: 0.8rem;">Tags IA</label>
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <span
                        style="font-size: 0.75rem; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 12px; opacity: 0.5;">tag1</span>
                    <span
                        style="font-size: 0.75rem; background: var(--bg-tertiary); padding: 2px 8px; border-radius: 12px; opacity: 0.5;">tag2</span>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 12px;">
            Enviar e Salvar Imagem
        </button>
    </div>
</form>

<script>
    const fileInput = document.getElementById('file-input');
    const previewContainer = document.getElementById('preview-container');
    const imagePreview = document.getElementById('image-preview');
    const dropZone = document.getElementById('drop-zone');

    fileInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                imagePreview.src = e.target.result;
                previewContainer.style.display = 'block';
                dropZone.style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
================================================================================
ARQUIVO: ./templates/collections/list.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Coleções</h1>
        <p style="color: var(--text-secondary);">Gerencie e catalogue todas as coleções de imagens.</p>
    </div>
    <a href="{{ url_for('new_collection') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Nova Coleção
    </a>
</div>

<div style="margin-bottom: 2rem; display: flex; gap: 1rem;">
    <form method="GET" action="{{ url_for('collections') }}" style="display: flex; gap: 1rem; flex: 1;">
        <div class="search-bar" style="flex: 1; width: auto;">
            <i class="fas fa-search"></i>
            <input type="text" name="search" placeholder="Buscar por nome da coleção..." value="{{ request.args.get('search', '') }}">
        </div>
        <select name="season" class="form-control" style="width: 180px;" onchange="this.form.submit()">
            <option value="">Todas as Estações</option>
            <option value="Primavera/Verão" {% if request.args.get('season') == 'Primavera/Verão' %}selected{% endif %}>Primavera/Verão</option>
            <option value="Outono/Inverno" {% if request.args.get('season') == 'Outono/Inverno' %}selected{% endif %}>Outono/Inverno</option>
            <option value="Alto Verão" {% if request.args.get('season') == 'Alto Verão' %}selected{% endif %}>Alto Verão</option>
            <option value="Cruise" {% if request.args.get('season') == 'Cruise' %}selected{% endif %}>Cruise</option>
            <option value="Resort" {% if request.args.get('season') == 'Resort' %}selected{% endif %}>Resort</option>
        </select>
        <select name="year" class="form-control" style="width: 120px;" onchange="this.form.submit()">
            <option value="">Todos os Anos</option>
            {% for y in range(2020, 2028) %}
            <option value="{{ y }}" {% if request.args.get('year')|int == y %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>
    </form>
</div>

{% if collections %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
    {% for collection in collections %}
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
                <h3 style="margin-bottom: 0.25rem;">{{ collection.name }}</h3>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                    {% if collection.year %}
                    <span style="background: var(--accent-blue); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">
                        {{ collection.year }}
                    </span>
                    {% endif %}
                    {% if collection.season %}
                    <span style="background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">
                        {{ collection.season }}
                    </span>
                    {% endif %}
                    {% if collection.campanha %}
                    <span style="background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">
                        {{ collection.campanha }}
                    </span>
                    {% endif %}
                </div>
            </div>
            <span style="background: var(--bg-tertiary); padding: 4px 10px; border-radius: 4px; font-size: 0.8rem;">
                {{ collection.images | length }} imagens
            </span>
        </div>

        {% if collection.description %}
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            {{ collection.description[:100] }}{% if collection.description|length > 100 %}...{% endif %}
        </p>
        {% endif %}

        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-secondary); border-top: 1px solid var(--border-color); padding-top: 1rem;">
            <span>Criado em {{ collection.created_at.strftime('%d/%m/%Y') }}</span>
            <div style="display: flex; gap: 1rem;">
                <a href="{{ url_for('edit_collection', id=collection.id) }}" style="color: var(--text-secondary);">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{{ url_for('catalog') }}?collection_id={{ collection.id }}" style="color: var(--accent-blue);">
                    Ver imagens <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-folder-open"></i>
    </div>
    <h3>Nenhuma Coleção Encontrada</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Crie sua primeira coleção para organizar imagens.</p>
    <a href="{{ url_for('new_collection') }}" class="btn btn-primary">Criar Nova Coleção</a>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/collections/new.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <h1>Nova Coleção</h1>
        <p style="color: var(--text-secondary);">Crie uma nova coleção para organizar suas imagens.</p>
    </div>

    <div class="card">
        <form method="POST" action="{{ url_for('new_collection') }}">
            <div class="form-group">
                <label class="form-label">Nome da Coleção *</label>
                <input type="text" name="name" class="form-control" placeholder="Ex: Verão 2025" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label">Ano</label>
                    <select name="year" class="form-control">
                        <option value="">Selecione...</option>
                        {% for y in years %}
                        <option value="{{ y }}">{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Estação</label>
                    <select name="season" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="Primavera/Verão">Primavera/Verão</option>
                        <option value="Outono/Inverno">Outono/Inverno</option>
                        <option value="Alto Verão">Alto Verão</option>
                        <option value="Cruise">Cruise</option>
                        <option value="Resort">Resort</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Campanha</label>
                    <input type="text" name="campanha" class="form-control" placeholder="Ex: Lançamento Verão">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Descrição</label>
                <textarea name="description" class="form-control" rows="4"
                    placeholder="Descrição da coleção..."></textarea>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                <a href="{{ url_for('collections') }}" class="btn"
                    style="border: 1px solid var(--border-color); color: var(--text-primary);">Cancelar</a>
                <button type="submit" class="btn btn-primary">Criar Coleção</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/collections/edit.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <h1>Editar Coleção</h1>
        <p style="color: var(--text-secondary);">Atualize as informações da coleção.</p>
    </div>

    <div class="card">
        <form method="POST" action="{{ url_for('edit_collection', id=collection.id) }}">
            <div class="form-group">
                <label class="form-label">Nome da Coleção *</label>
                <input type="text" name="name" class="form-control" value="{{ collection.name }}" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label">Ano</label>
                    <select name="year" class="form-control">
                        <option value="">Selecione...</option>
                        {% for y in years %}
                        <option value="{{ y }}" {% if collection.year == y %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Estação</label>
                    <select name="season" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="Primavera/Verão" {% if collection.season == 'Primavera/Verão' %}selected{% endif %}>Primavera/Verão</option>
                        <option value="Outono/Inverno" {% if collection.season == 'Outono/Inverno' %}selected{% endif %}>Outono/Inverno</option>
                        <option value="Alto Verão" {% if collection.season == 'Alto Verão' %}selected{% endif %}>Alto Verão</option>
                        <option value="Cruise" {% if collection.season == 'Cruise' %}selected{% endif %}>Cruise</option>
                        <option value="Resort" {% if collection.season == 'Resort' %}selected{% endif %}>Resort</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Campanha</label>
                    <input type="text" name="campanha" class="form-control" value="{{ collection.campanha or '' }}" placeholder="Ex: Lançamento Verão">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Descrição</label>
                <textarea name="description" class="form-control" rows="4">{{ collection.description or '' }}</textarea>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <form method="POST" action="{{ url_for('delete_collection', id=collection.id) }}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir esta coleção?');">
                    <button type="submit" class="btn" style="color: #ef4444; border: 1px solid #ef4444;">
                        <i class="fas fa-trash"></i> Excluir Coleção
                    </button>
                </form>
                
                <div style="display: flex; gap: 1rem;">
                    <a href="{{ url_for('collections') }}" class="btn" style="border: 1px solid var(--border-color); color: var(--text-primary);">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </div>
        </form>
    </div>
    
    {% if collection.images %}
    <div class="card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1rem;">Imagens nesta Coleção ({{ collection.images | length }})</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.5rem;">
            {% for img in collection.images[:12] %}
            <a href="{{ url_for('image_detail', id=img.id) }}">
                <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" 
                     alt="{{ img.original_name }}"
                     style="width: 100%; height: 100px; object-fit: cover; border-radius: 4px;">
            </a>
            {% endfor %}
        </div>
        {% if collection.images | length > 12 %}
        <a href="{{ url_for('catalog') }}?collection_id={{ collection.id }}" style="display: block; text-align: center; margin-top: 1rem; color: var(--accent-blue);">
            Ver todas as {{ collection.images | length }} imagens <i class="fas fa-arrow-right"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/brands/list.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Marcas</h1>
        <p style="color: var(--text-secondary);">Gerencie as marcas cadastradas no sistema.</p>
    </div>
    <a href="{{ url_for('new_brand') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Nova Marca
    </a>
</div>

{% if brands %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
    {% for brand in brands %}
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
                <h3 style="margin-bottom: 0.25rem;">{{ brand.name }}</h3>
                <span style="color: var(--accent-blue); font-size: 0.8rem;">
                    {{ brand.images | length }} imagens
                </span>
            </div>
        </div>

        {% if brand.description %}
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            {{ brand.description }}
        </p>
        {% endif %}

        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-secondary); border-top: 1px solid var(--border-color); padding-top: 1rem;">
            <span>Criado em {{ brand.created_at.strftime('%d/%m/%Y') }}</span>
            <a href="{{ url_for('catalog') }}?brand_id={{ brand.id }}" style="color: var(--accent-blue);">
                Ver imagens <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-tag"></i>
    </div>
    <h3>Nenhuma Marca Cadastrada</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Crie sua primeira marca para organizar as imagens.</p>
    <a href="{{ url_for('new_brand') }}" class="btn btn-primary">Criar Nova Marca</a>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/brands/new.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Nova Marca</h1>
    <p style="color: var(--text-secondary);">Cadastre uma nova marca no sistema.</p>
</div>

<div class="stat-card" style="max-width: 600px; padding: 2rem;">
    <form method="POST" action="{{ url_for('new_brand') }}">
        <div class="form-group">
            <label class="form-label">Nome da Marca *</label>
            <input type="text" name="name" class="form-control" placeholder="Ex: OAZ, Nike, Adidas..." required>
        </div>
        
        <div class="form-group">
            <label class="form-label">Descrição (Opcional)</label>
            <textarea name="description" class="form-control" rows="3" placeholder="Descrição da marca..."></textarea>
        </div>
        
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Salvar Marca
            </button>
            <a href="{{ url_for('brands') }}" class="btn" style="background: var(--bg-tertiary); color: var(--text-primary);">
                Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/produtos/list.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Produtos</h1>
        <p style="color: var(--text-secondary);">Gerencie os produtos cadastrados no sistema.</p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('new_produto') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Novo Produto
        </a>
        <a href="{{ url_for('export_produtos_csv') }}" class="btn" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
            <i class="fas fa-file-export"></i> Exportar CSV
        </a>
    </div>
</div>

<div class="dashboard-stats" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Total de Produtos</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ total_produtos }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(31, 111, 235, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-box" style="color: var(--accent-blue); font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Com Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #3fb950;">{{ com_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(63, 185, 80, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-image" style="color: #3fb950; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Sem Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #f85149;">{{ sem_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-image" style="color: #f85149; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>
</div>

<div class="stat-card" style="margin-bottom: 2rem;">
    <form action="{{ url_for('produtos') }}" method="GET" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 200px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Buscar</label>
            <div style="position: relative;">
                <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
                <input type="text" name="q" class="form-control" style="padding-left: 40px;" placeholder="SKU, descrição..." value="{{ search_query or '' }}">
            </div>
        </div>

        <div style="min-width: 150px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Marca</label>
            <select name="marca_id" class="form-control">
                <option value="">Todas as Marcas</option>
                {% for marca in marcas %}
                <option value="{{ marca.id }}" {% if request.args.get('marca_id') == marca.id|string %}selected{% endif %}>
                    {{ marca.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div style="min-width: 150px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Coleção</label>
            <select name="colecao_id" class="form-control">
                <option value="">Todas as Coleções</option>
                {% for colecao in colecoes %}
                <option value="{{ colecao.id }}" {% if request.args.get('colecao_id') == colecao.id|string %}selected{% endif %}>
                    {{ colecao.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div style="min-width: 150px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Status Foto</label>
            <select name="status_foto" class="form-control">
                <option value="">Todos</option>
                <option value="com_foto" {% if request.args.get('status_foto') == 'com_foto' %}selected{% endif %}>Com Foto</option>
                <option value="sem_foto" {% if request.args.get('status_foto') == 'sem_foto' %}selected{% endif %}>Sem Foto</option>
            </select>
        </div>

        <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Filtrar
            </button>
            <a href="{{ url_for('produtos') }}" class="btn" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                <i class="fas fa-times"></i> Limpar
            </a>
        </div>
    </form>
</div>

{% if produtos %}
<div class="stat-card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Descrição</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Cor</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Categoria</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Marca</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Coleção</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Status Foto</th>
                <th style="padding: 1rem; text-align: center; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 1rem; font-weight: 500;">{{ produto.sku }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.descricao }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.cor or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.categoria or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.marca.name if produto.marca else '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.colecao.name if produto.colecao else '-' }}</td>
                <td style="padding: 1rem;">
                    {% if produto.tem_foto %}
                    <span class="status-badge" style="background-color: rgba(63, 185, 80, 0.2); color: #3fb950;">
                        <i class="fas fa-check"></i> Com Foto
                    </span>
                    {% else %}
                    <span class="status-badge" style="background-color: rgba(248, 81, 73, 0.2); color: #f85149;">
                        <i class="fas fa-times"></i> Sem Foto
                    </span>
                    {% endif %}
                </td>
                <td style="padding: 1rem; text-align: center;">
                    <div style="display: flex; gap: 0.5rem; justify-content: center;">
                        <a href="{{ url_for('edit_produto', id=produto.id) }}" class="btn" style="padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--accent-blue);" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form action="{{ url_for('delete_produto', id=produto.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir este produto?');">
                            <button type="submit" class="btn" style="padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: #f85149;" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-box-open"></i>
    </div>
    <h3>Nenhum Produto Encontrado</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Cadastre seu primeiro produto para começar.</p>
    <a href="{{ url_for('new_produto') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Novo Produto
    </a>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/produtos/new.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('produtos') }}" style="color: var(--text-secondary); font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-arrow-left"></i> Voltar para Produtos
    </a>
    <h1 style="margin-top: 1rem;">Novo Produto</h1>
    <p style="color: var(--text-secondary);">Preencha os campos abaixo para cadastrar um novo produto.</p>
</div>

<div class="stat-card" style="max-width: 800px;">
    <form action="{{ url_for('new_produto') }}" method="POST">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div class="form-group">
                <label class="form-label">
                    SKU <span style="color: #f85149;">*</span>
                </label>
                <input type="text" name="sku" class="form-control" required placeholder="Ex: ABC-12345">
            </div>

            <div class="form-group">
                <label class="form-label">
                    Descrição <span style="color: #f85149;">*</span>
                </label>
                <input type="text" name="descricao" class="form-control" required placeholder="Nome do produto">
            </div>

            <div class="form-group">
                <label class="form-label">Cor</label>
                <input type="text" name="cor" class="form-control" placeholder="Ex: Azul, Vermelho">
            </div>

            <div class="form-group">
                <label class="form-label">Categoria</label>
                <input type="text" name="categoria" class="form-control" placeholder="Ex: Eletrônicos, Roupas">
            </div>

            <div class="form-group">
                <label class="form-label">Marca</label>
                <select name="marca_id" class="form-control">
                    <option value="">Selecione uma marca</option>
                    {% for marca in marcas %}
                    <option value="{{ marca.id }}">{{ marca.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Coleção</label>
                <select name="colecao_id" class="form-control">
                    <option value="">Selecione uma coleção</option>
                    {% for colecao in colecoes %}
                    <option value="{{ colecao.id }}">{{ colecao.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group" style="margin-top: 1.5rem;">
            <label class="form-label">Atributos Técnicos</label>
            <textarea name="atributos_tecnicos" class="form-control" rows="4" placeholder="Descreva os atributos técnicos do produto (material, dimensões, peso, etc.)"></textarea>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Cadastrar Produto
            </button>
            <a href="{{ url_for('produtos') }}" class="btn" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/produtos/edit.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('produtos') }}" style="color: var(--text-secondary); font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-arrow-left"></i> Voltar para Produtos
    </a>
    <h1 style="margin-top: 1rem;">Editar Produto</h1>
    <p style="color: var(--text-secondary);">Atualize as informações do produto.</p>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
    <div>
        <div class="stat-card">
            <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-edit" style="color: var(--accent-blue);"></i> Informações do Produto
            </h3>
            <form action="{{ url_for('edit_produto', id=produto.id) }}" method="POST" id="editForm">
                <input type="hidden" name="sku_original" value="{{ produto.sku }}">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="form-group">
                        <label class="form-label">
                            SKU <span style="color: #f85149;">*</span>
                        </label>
                        <input type="text" name="sku" id="skuInput" class="form-control" required value="{{ produto.sku }}" onchange="checkSkuChange()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Descrição <span style="color: #f85149;">*</span>
                        </label>
                        <input type="text" name="descricao" class="form-control" required value="{{ produto.descricao }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cor</label>
                        <input type="text" name="cor" class="form-control" value="{{ produto.cor or '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <input type="text" name="categoria" class="form-control" value="{{ produto.categoria or '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Marca</label>
                        <select name="marca_id" class="form-control">
                            <option value="">Selecione uma marca</option>
                            {% for marca in marcas %}
                            <option value="{{ marca.id }}" {% if produto.marca_id == marca.id %}selected{% endif %}>{{ marca.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Coleção</label>
                        <select name="colecao_id" class="form-control">
                            <option value="">Selecione uma coleção</option>
                            {% for colecao in colecoes %}
                            <option value="{{ colecao.id }}" {% if produto.colecao_id == colecao.id %}selected{% endif %}>{{ colecao.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">Atributos Técnicos</label>
                    <textarea name="atributos_tecnicos" class="form-control" rows="4">{{ produto.atributos_tecnicos or '' }}</textarea>
                </div>

                <div id="motivoAlteracaoDiv" style="display: none; margin-top: 1.5rem; padding: 1rem; background: rgba(210, 153, 34, 0.1); border: 1px solid #d29922; border-radius: 8px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label" style="color: #d29922;">
                            <i class="fas fa-exclamation-triangle"></i> Motivo da Alteração do SKU <span style="color: #f85149;">*</span>
                        </label>
                        <textarea name="motivo_alteracao" id="motivoAlteracao" class="form-control" rows="2" placeholder="Descreva o motivo da alteração do SKU"></textarea>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                    <a href="{{ url_for('produtos') }}" class="btn" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>

        {% if historico_sku %}
        <div class="stat-card" style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-history" style="color: #d29922;"></i> Histórico de Alterações de SKU
            </h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU Antigo</th>
                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU Novo</th>
                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Data</th>
                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Motivo</th>
                        <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Usuário</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in historico_sku %}
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 0.75rem; font-family: monospace; color: #f85149;">{{ item.sku_antigo }}</td>
                        <td style="padding: 0.75rem; font-family: monospace; color: #3fb950;">{{ item.sku_novo }}</td>
                        <td style="padding: 0.75rem; color: var(--text-secondary);">{{ item.data_alteracao.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td style="padding: 0.75rem; color: var(--text-secondary);">{{ item.motivo or '-' }}</td>
                        <td style="padding: 0.75rem; color: var(--text-secondary);">{{ item.usuario.username if item.usuario else '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>

    <div>
        <div class="stat-card">
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-images" style="color: var(--accent-blue);"></i> Imagens Associadas
            </h3>

            {% if produto.imagens %}
            <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem;">
                {% for imagem in produto.imagens %}
                <div style="display: flex; gap: 0.75rem; align-items: center; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px;">
                    <div style="width: 50px; height: 50px; border-radius: 6px; overflow: hidden; flex-shrink: 0;">
                        <img src="{{ url_for('static', filename='uploads/' + imagem.filename) }}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 500; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ imagem.sku or imagem.original_name }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ imagem.status }}</div>
                    </div>
                    <form action="{{ url_for('desassociar_imagem', produto_id=produto.id, imagem_id=imagem.id) }}" method="POST" onsubmit="return confirm('Desassociar esta imagem?');">
                        <button type="submit" style="background: none; border: none; color: #f85149; cursor: pointer; padding: 4px;" title="Desassociar">
                            <i class="fas fa-unlink"></i>
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 2rem; color: var(--text-secondary); background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 1.5rem;">
                <i class="fas fa-image" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                <p style="font-size: 0.9rem;">Nenhuma imagem associada</p>
            </div>
            {% endif %}

            <form action="{{ url_for('associar_imagem', produto_id=produto.id) }}" method="POST" style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Associar Nova Imagem</label>
                    <select name="imagem_id" class="form-control" required>
                        <option value="">Selecione uma imagem</option>
                        {% for imagem in imagens_disponiveis %}
                        <option value="{{ imagem.id }}">{{ imagem.sku or imagem.original_name }} - {{ imagem.status }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    <i class="fas fa-link"></i> Associar
                </button>
            </form>
        </div>
    </div>
</div>

<script>
const skuOriginal = "{{ produto.sku }}";

function checkSkuChange() {
    const skuAtual = document.getElementById('skuInput').value;
    const motivoDiv = document.getElementById('motivoAlteracaoDiv');
    const motivoInput = document.getElementById('motivoAlteracao');
    
    if (skuAtual !== skuOriginal) {
        motivoDiv.style.display = 'block';
        motivoInput.required = true;
    } else {
        motivoDiv.style.display = 'none';
        motivoInput.required = false;
    }
}

document.getElementById('skuInput').addEventListener('input', checkSkuChange);
</script>
{% endblock %}

================================================================================
ARQUIVO: ./templates/carteira/list.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Carteira de Produtos</h1>
        <p style="color: var(--text-secondary);">Gerencie a carteira de produtos importada.</p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('importar_carteira') }}" class="btn btn-primary">
            <i class="fas fa-file-import"></i> Importar CSV
        </a>
        <a href="{{ url_for('cruzar_carteira') }}" class="btn" style="background: rgba(63, 185, 80, 0.2); border: 1px solid #3fb950; color: #3fb950;">
            <i class="fas fa-sync-alt"></i> Executar Cruzamento
        </a>
        <a href="{{ url_for('export_carteira') }}" class="btn" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
            <i class="fas fa-file-export"></i> Exportar CSV
        </a>
    </div>
</div>

<div class="dashboard-stats" style="margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Total na Carteira</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ total_carteira }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(31, 111, 235, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-wallet" style="color: var(--accent-blue); font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Com Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #3fb950;">{{ com_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(63, 185, 80, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-check-circle" style="color: #3fb950; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Sem Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #f85149;">{{ sem_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-times-circle" style="color: #f85149; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Pendente</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #d29922;">{{ pendente }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(210, 153, 34, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-clock" style="color: #d29922; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>
</div>

<div class="stat-card" style="margin-bottom: 2rem;">
    <form action="{{ url_for('carteira') }}" method="GET" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 250px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Buscar</label>
            <div style="position: relative;">
                <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
                <input type="text" name="q" class="form-control" style="padding-left: 40px;" placeholder="SKU, descrição..." value="{{ search_query or '' }}">
            </div>
        </div>

        <div style="min-width: 180px;">
            <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Status</label>
            <select name="status" class="form-control">
                <option value="">Todos os Status</option>
                <option value="Com Foto" {% if request.args.get('status') == 'Com Foto' %}selected{% endif %}>Com Foto</option>
                <option value="Sem Foto" {% if request.args.get('status') == 'Sem Foto' %}selected{% endif %}>Sem Foto</option>
                <option value="Pendente" {% if request.args.get('status') == 'Pendente' %}selected{% endif %}>Pendente</option>
            </select>
        </div>

        <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Filtrar
            </button>
            <a href="{{ url_for('carteira') }}" class="btn" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                <i class="fas fa-times"></i> Limpar
            </a>
        </div>
    </form>
</div>

{% if itens_carteira %}
<div class="stat-card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Descrição</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Cor</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Categoria</th>
                <th style="padding: 1rem; text-align: center; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Quantidade</th>
                <th style="padding: 1rem; text-align: center; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Status</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Data Importação</th>
            </tr>
        </thead>
        <tbody>
            {% for item in itens_carteira %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 1rem; font-weight: 500; font-family: monospace;">{{ item.sku }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ item.descricao or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ item.cor or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ item.categoria or '-' }}</td>
                <td style="padding: 1rem; text-align: center; font-weight: 500;">{{ item.quantidade }}</td>
                <td style="padding: 1rem; text-align: center;">
                    {% if item.status_foto == 'Com Foto' %}
                    <span class="status-badge" style="background-color: rgba(63, 185, 80, 0.2); color: #3fb950;">
                        <i class="fas fa-check"></i> Com Foto
                    </span>
                    {% elif item.status_foto == 'Sem Foto' %}
                    <span class="status-badge" style="background-color: rgba(248, 81, 73, 0.2); color: #f85149;">
                        <i class="fas fa-times"></i> Sem Foto
                    </span>
                    {% else %}
                    <span class="status-badge" style="background-color: rgba(210, 153, 34, 0.2); color: #d29922;">
                        <i class="fas fa-clock"></i> Pendente
                    </span>
                    {% endif %}
                </td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ item.data_importacao.strftime('%d/%m/%Y %H:%M') if item.data_importacao else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-wallet"></i>
    </div>
    <h3>Carteira Vazia</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Importe um arquivo CSV para popular a carteira de produtos.</p>
    <a href="{{ url_for('importar_carteira') }}" class="btn btn-primary">
        <i class="fas fa-file-import"></i> Importar CSV
    </a>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/carteira/importar.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('carteira') }}" style="color: var(--text-secondary); font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-arrow-left"></i> Voltar para Carteira
    </a>
    <h1 style="margin-top: 1rem;">Importar Carteira</h1>
    <p style="color: var(--text-secondary);">Importe um arquivo CSV com os produtos da carteira.</p>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
    <div class="stat-card">
        <form action="{{ url_for('importar_carteira') }}" method="POST" enctype="multipart/form-data" id="importForm">
            <div class="upload-area" id="dropZone" style="height: 300px; cursor: pointer;" onclick="document.getElementById('fileInput').click();">
                <div style="text-align: center;">
                    <div class="upload-icon">
                        <i class="fas fa-file-csv"></i>
                    </div>
                    <h3 style="margin-bottom: 0.5rem;">Arraste e solte seu arquivo CSV aqui</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">ou clique para selecionar</p>
                    <span class="btn btn-primary">
                        <i class="fas fa-upload"></i> Selecionar Arquivo
                    </span>
                </div>
            </div>
            <input type="file" name="arquivo" id="fileInput" accept=".csv" style="display: none;" required onchange="handleFileSelect(this)">
            
            <div id="filePreview" style="display: none; margin-top: 1.5rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-file-csv" style="font-size: 2rem; color: #3fb950;"></i>
                    <div style="flex: 1;">
                        <div id="fileName" style="font-weight: 500;"></div>
                        <div id="fileSize" style="font-size: 0.85rem; color: var(--text-secondary);"></div>
                    </div>
                    <button type="button" onclick="clearFile()" style="background: none; border: none; color: #f85149; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 12px;">
                    <i class="fas fa-file-import"></i> Importar Carteira
                </button>
            </div>
        </form>
    </div>

    <div>
        <div class="stat-card">
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-info-circle" style="color: var(--accent-blue);"></i> Formato do Arquivo
            </h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                O arquivo CSV deve conter as seguintes colunas:
            </p>
            <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <code style="color: #3fb950; font-size: 0.85rem;">
                    sku, descricao, cor, categoria, quantidade
                </code>
            </div>
            
            <h4 style="font-size: 0.9rem; margin-bottom: 0.75rem; color: var(--text-secondary);">Descrição das colunas:</h4>
            <ul style="font-size: 0.85rem; color: var(--text-secondary); padding-left: 1.25rem; list-style: disc;">
                <li style="margin-bottom: 0.5rem;"><strong style="color: var(--text-primary);">sku</strong> - Código único do produto (obrigatório)</li>
                <li style="margin-bottom: 0.5rem;"><strong style="color: var(--text-primary);">descricao</strong> - Descrição do produto</li>
                <li style="margin-bottom: 0.5rem;"><strong style="color: var(--text-primary);">cor</strong> - Cor do produto</li>
                <li style="margin-bottom: 0.5rem;"><strong style="color: var(--text-primary);">categoria</strong> - Categoria do produto</li>
                <li><strong style="color: var(--text-primary);">quantidade</strong> - Quantidade em estoque</li>
            </ul>
        </div>

        <div class="stat-card" style="margin-top: 1.5rem;">
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-lightbulb" style="color: #d29922;"></i> Dicas
            </h3>
            <ul style="font-size: 0.85rem; color: var(--text-secondary); padding-left: 1.25rem; list-style: disc;">
                <li style="margin-bottom: 0.5rem;">Use ponto e vírgula (;) ou vírgula (,) como separador</li>
                <li style="margin-bottom: 0.5rem;">A primeira linha deve conter os nomes das colunas</li>
                <li style="margin-bottom: 0.5rem;">Codificação UTF-8 é recomendada</li>
                <li>SKUs duplicados serão atualizados</li>
            </ul>
        </div>
    </div>
</div>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const filePreview = document.getElementById('filePreview');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

['dragenter', 'dragover'].forEach(eventName => {
    dropZone.addEventListener(eventName, highlight, false);
});

['dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, unhighlight, false);
});

function highlight(e) {
    dropZone.style.borderColor = 'var(--accent-blue)';
    dropZone.style.backgroundColor = 'rgba(31, 111, 235, 0.1)';
}

function unhighlight(e) {
    dropZone.style.borderColor = '';
    dropZone.style.backgroundColor = '';
}

dropZone.addEventListener('drop', handleDrop, false);

function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    if (files.length > 0) {
        fileInput.files = files;
        handleFileSelect(fileInput);
    }
}

function handleFileSelect(input) {
    const file = input.files[0];
    if (file) {
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatFileSize(file.size);
        filePreview.style.display = 'block';
        dropZone.style.display = 'none';
    }
}

function clearFile() {
    fileInput.value = '';
    filePreview.style.display = 'none';
    dropZone.style.display = 'flex';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
</script>
{% endblock %}

================================================================================
ARQUIVO: ./templates/auditoria/index.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Auditoria</h1>
    <p style="color: var(--text-secondary);">Dashboard de auditoria e controle de qualidade.</p>
</div>

<h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
    <i class="fas fa-box" style="color: var(--accent-blue);"></i> Status dos Produtos
</h3>
<div class="dashboard-stats" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Total de Produtos</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ total_produtos }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(31, 111, 235, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-boxes" style="color: var(--accent-blue); font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Produtos com Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #3fb950;">{{ produtos_com_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(63, 185, 80, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-image" style="color: #3fb950; font-size: 1.25rem;"></i>
            </div>
        </div>
        <a href="{{ url_for('export_auditoria', tipo='produtos_com_foto') }}" style="color: var(--accent-blue); font-size: 0.85rem; margin-top: 0.5rem; display: inline-block;">
            <i class="fas fa-download"></i> Exportar lista
        </a>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Produtos sem Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #f85149;">{{ produtos_sem_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-image" style="color: #f85149; font-size: 1.25rem;"></i>
            </div>
        </div>
        <a href="{{ url_for('skus_pendentes') }}" style="color: var(--accent-blue); font-size: 0.85rem; margin-top: 0.5rem; display: inline-block;">
            <i class="fas fa-list"></i> Ver lista completa
        </a>
    </div>
</div>

<h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
    <i class="fas fa-wallet" style="color: var(--accent-blue);"></i> Status da Carteira
</h3>
<div class="dashboard-stats" style="margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Total na Carteira</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ carteira_total }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(31, 111, 235, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-wallet" style="color: var(--accent-blue); font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Com Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #3fb950;">{{ carteira_com_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(63, 185, 80, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-check-circle" style="color: #3fb950; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Sem Foto</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #f85149;">{{ carteira_sem_foto }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-times-circle" style="color: #f85149; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Pendente</p>
                <h2 style="font-size: 2rem; font-weight: 600; color: #d29922;">{{ carteira_pendente }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(210, 153, 34, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-clock" style="color: #d29922; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-history" style="color: #d29922;"></i> Alterações Recentes de SKU
            </h3>
            <a href="{{ url_for('historico_sku') }}" style="color: var(--accent-blue); font-size: 0.85rem;">
                Ver histórico completo <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        
        {% if alteracoes_sku %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">SKU Antigo</th>
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">SKU Novo</th>
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">Data</th>
                </tr>
            </thead>
            <tbody>
                {% for item in alteracoes_sku[:10] %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 0.5rem; font-family: monospace; font-size: 0.85rem; color: #f85149;">{{ item.sku_antigo }}</td>
                    <td style="padding: 0.5rem; font-family: monospace; font-size: 0.85rem; color: #3fb950;">{{ item.sku_novo }}</td>
                    <td style="padding: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">{{ item.data_alteracao.strftime('%d/%m/%Y') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 0.5rem; color: #3fb950;"></i>
            <p>Nenhuma alteração de SKU registrada</p>
        </div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-exclamation-triangle" style="color: #f85149;"></i> Divergências
            </h3>
        </div>
        
        {% if divergencias %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">SKU Carteira</th>
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">SKU Novo</th>
                    <th style="padding: 0.5rem; text-align: left; font-weight: 600; font-size: 0.8rem; color: var(--text-secondary);">Data</th>
                </tr>
            </thead>
            <tbody>
                {% for div in divergencias[:10] %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 0.5rem; font-family: monospace; font-size: 0.85rem; color: #f85149;">{{ div.sku_antigo }}</td>
                    <td style="padding: 0.5rem; font-family: monospace; font-size: 0.85rem; color: #3fb950;">{{ div.sku_novo }}</td>
                    <td style="padding: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">{{ div.data.strftime('%d/%m/%Y') if div.data else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <p style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
            <i class="fas fa-info-circle"></i> SKUs na carteira que foram atualizados no cadastro de produtos
        </p>
        {% else %}
        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 0.5rem; color: #3fb950;"></i>
            <p>Nenhuma divergência encontrada</p>
        </div>
        {% endif %}
    </div>
</div>

<div class="stat-card" style="margin-top: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-image" style="color: #f85149;"></i> SKUs Pendentes (Sem Foto)
        </h3>
        <div style="display: flex; gap: 0.5rem;">
            <a href="{{ url_for('skus_pendentes') }}" class="btn" style="padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); font-size: 0.85rem;">
                <i class="fas fa-list"></i> Ver Todos
            </a>
            <a href="{{ url_for('export_auditoria', tipo='produtos_sem_foto') }}" class="btn" style="padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); font-size: 0.85rem;">
                <i class="fas fa-download"></i> Exportar CSV
            </a>
        </div>
    </div>
    
    {% if skus_pendentes %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 1px solid var(--border-color);">
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU</th>
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Descrição</th>
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Cor</th>
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Marca</th>
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Coleção</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in skus_pendentes[:20] %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 0.75rem; font-weight: 500; font-family: monospace;">{{ produto.sku }}</td>
                <td style="padding: 0.75rem; color: var(--text-secondary);">{{ produto.descricao or '-' }}</td>
                <td style="padding: 0.75rem; color: var(--text-secondary);">{{ produto.cor or '-' }}</td>
                <td style="padding: 0.75rem; color: var(--text-secondary);">{{ produto.marca.name if produto.marca else '-' }}</td>
                <td style="padding: 0.75rem; color: var(--text-secondary);">{{ produto.colecao.name if produto.colecao else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if skus_pendentes|length > 20 %}
    <div style="text-align: center; padding: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
        Mostrando 20 de {{ skus_pendentes|length }} produtos pendentes. <a href="{{ url_for('skus_pendentes') }}" style="color: var(--accent-blue);">Ver todos</a>
    </div>
    {% endif %}
    {% else %}
    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 0.5rem; color: #3fb950;"></i>
        <p>Todos os produtos possuem foto!</p>
    </div>
    {% endif %}
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/auditoria/historico_sku.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <a href="{{ url_for('auditoria') }}" style="color: var(--text-secondary); font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-arrow-left"></i> Voltar para Auditoria
        </a>
        <h1 style="margin-top: 1rem;">Histórico de Alterações de SKU</h1>
        <p style="color: var(--text-secondary);">Registro completo de todas as alterações de SKU no sistema.</p>
    </div>
    <a href="{{ url_for('exportar_auditoria', tipo='historico_sku') }}" class="btn" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
        <i class="fas fa-file-export"></i> Exportar CSV
    </a>
</div>

{% if historico %}
<div class="stat-card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU Antigo</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU Novo</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Data da Alteração</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Motivo</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Usuário</th>
            </tr>
        </thead>
        <tbody>
            {% for item in historico %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 1rem;">
                    <span style="font-family: monospace; background: rgba(248, 81, 73, 0.1); color: #f85149; padding: 4px 8px; border-radius: 4px;">
                        {{ item.sku_antigo }}
                    </span>
                </td>
                <td style="padding: 1rem;">
                    <span style="font-family: monospace; background: rgba(63, 185, 80, 0.1); color: #3fb950; padding: 4px 8px; border-radius: 4px;">
                        {{ item.sku_novo }}
                    </span>
                </td>
                <td style="padding: 1rem; color: var(--text-secondary);">
                    <i class="far fa-calendar-alt" style="margin-right: 0.5rem;"></i>
                    {{ item.data_alteracao.strftime('%d/%m/%Y às %H:%M') }}
                </td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ item.motivo or '-' }}</td>
                <td style="padding: 1rem;">
                    {% if item.usuario %}
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 28px; height: 28px; border-radius: 50%; background: var(--accent-blue); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 600;">
                            {{ item.usuario.username[0].upper() }}
                        </div>
                        <span>{{ item.usuario.username }}</span>
                    </div>
                    {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-history"></i>
    </div>
    <h3>Nenhum Histórico Encontrado</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Não há registro de alterações de SKU no sistema.</p>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/auditoria/skus_pendentes.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <a href="{{ url_for('auditoria') }}" style="color: var(--text-secondary); font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-arrow-left"></i> Voltar para Auditoria
        </a>
        <h1 style="margin-top: 1rem;">Produtos sem Foto</h1>
        <p style="color: var(--text-secondary);">Lista completa de produtos que ainda não possuem foto associada.</p>
    </div>
    <a href="{{ url_for('exportar_auditoria', tipo='skus_pendentes') }}" class="btn" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
        <i class="fas fa-file-export"></i> Exportar CSV
    </a>
</div>

<div class="stat-card" style="margin-bottom: 2rem; display: inline-flex; align-items: center; gap: 1rem; padding: 1rem 1.5rem;">
    <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-exclamation-circle" style="color: #f85149; font-size: 1.25rem;"></i>
    </div>
    <div>
        <p style="color: var(--text-secondary); font-size: 0.9rem;">Total de SKUs Pendentes</p>
        <h2 style="font-size: 1.75rem; font-weight: 600; color: #f85149;">{{ produtos|length }}</h2>
    </div>
</div>

{% if produtos %}
<div class="stat-card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: var(--bg-tertiary); border-bottom: 1px solid var(--border-color);">
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">SKU</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Descrição</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Cor</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Marca</th>
                <th style="padding: 1rem; text-align: left; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Coleção</th>
                <th style="padding: 1rem; text-align: center; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary);">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr style="border-bottom: 1px solid var(--border-color);">
                <td style="padding: 1rem;">
                    <span style="font-family: monospace; font-weight: 500;">{{ produto.sku }}</span>
                </td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.descricao or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.cor or '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.marca.name if produto.marca else '-' }}</td>
                <td style="padding: 1rem; color: var(--text-secondary);">{{ produto.colecao.name if produto.colecao else '-' }}</td>
                <td style="padding: 1rem; text-align: center;">
                    <a href="{{ url_for('edit_produto', id=produto.id) }}" class="btn" style="padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--accent-blue); font-size: 0.85rem;" title="Associar Foto">
                        <i class="fas fa-link"></i> Associar Foto
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="stat-card" style="text-align: center; padding: 4rem;">
    <div style="font-size: 3rem; color: #3fb950; margin-bottom: 1rem;">
        <i class="fas fa-check-circle"></i>
    </div>
    <h3>Parabéns!</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Todos os produtos possuem foto associada.</p>
    <a href="{{ url_for('produtos') }}" class="btn btn-primary">
        <i class="fas fa-box"></i> Ver Produtos
    </a>
</div>
{% endif %}
{% endblock %}

================================================================================
ARQUIVO: ./templates/reports/index.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>Relatórios</h1>
            <p style="color: var(--text-secondary); margin-top: 0.5rem;">Métricas e estatísticas do banco de imagens</p>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <a href="{{ url_for('export_report', report_type='all') }}" class="btn btn-primary">
                <i class="fas fa-download"></i> Exportar Tudo (CSV)
            </a>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Total de Imagens</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ total_images }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(31, 111, 235, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-images" style="color: var(--accent-blue); font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Com SKU</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ images_with_sku }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(63, 185, 80, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-barcode" style="color: #3fb950; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Sem SKU</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ images_without_sku }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(248, 81, 73, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-exclamation-triangle" style="color: #f85149; font-size: 1.25rem;"></i>
            </div>
        </div>
        {% if images_without_sku > 0 %}
        <a href="{{ url_for('export_report', report_type='without_sku') }}" style="color: var(--accent-blue); font-size: 0.85rem; margin-top: 0.5rem; display: inline-block;">
            <i class="fas fa-download"></i> Exportar lista
        </a>
        {% endif %}
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Com Análise IA</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ images_with_ai }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(130, 80, 223, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-robot" style="color: #8250df; font-size: 1.25rem;"></i>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">Sem Análise IA</p>
                <h2 style="font-size: 2rem; font-weight: 600;">{{ images_without_ai }}</h2>
            </div>
            <div style="width: 48px; height: 48px; border-radius: 12px; background: rgba(201, 209, 217, 0.1); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-robot" style="color: #8b949e; font-size: 1.25rem;"></i>
            </div>
        </div>
        {% if images_without_ai > 0 %}
        <a href="{{ url_for('export_report', report_type='without_ai') }}" style="color: var(--accent-blue); font-size: 0.85rem; margin-top: 0.5rem; display: inline-block;">
            <i class="fas fa-download"></i> Exportar lista
        </a>
        {% endif %}
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="font-size: 1rem;">Por Status</h3>
        </div>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span class="status-badge status-pendente">Pendente</span>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-weight: 600;">{{ pending_images }}</span>
                    <a href="{{ url_for('export_report', report_type='pending') }}" style="color: var(--accent-blue); font-size: 0.8rem;">
                        <i class="fas fa-download"></i>
                    </a>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span class="status-badge status-aprovado">Aprovado</span>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-weight: 600;">{{ approved_images }}</span>
                    <a href="{{ url_for('export_report', report_type='approved') }}" style="color: var(--accent-blue); font-size: 0.8rem;">
                        <i class="fas fa-download"></i>
                    </a>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span class="status-badge status-rejeitado">Rejeitado</span>
                </div>
                <span style="font-weight: 600;">{{ rejected_images }}</span>
            </div>
        </div>
        {% if total_images > 0 %}
        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; display: flex;">
                {% set approved_pct = (approved_images / total_images * 100)|round(1) %}
                {% set pending_pct = (pending_images / total_images * 100)|round(1) %}
                {% set rejected_pct = (rejected_images / total_images * 100)|round(1) %}
                <div style="width: {{ approved_pct }}%; background: #3fb950;"></div>
                <div style="width: {{ pending_pct }}%; background: #d29922;"></div>
                <div style="width: {{ rejected_pct }}%; background: #f85149;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
                <span><span style="color: #3fb950;">●</span> {{ approved_pct }}% Aprovado</span>
                <span><span style="color: #d29922;">●</span> {{ pending_pct }}% Pendente</span>
                <span><span style="color: #f85149;">●</span> {{ rejected_pct }}% Rejeitado</span>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="font-size: 1rem;">Por Marca</h3>
        </div>
        {% if brands_stats %}
        <div style="display: flex; flex-direction: column; gap: 0.75rem; max-height: 200px; overflow-y: auto;">
            {% for brand in brands_stats %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 6px;">
                <span style="font-weight: 500;">{{ brand.name }}</span>
                <div style="display: flex; gap: 1rem; font-size: 0.85rem;">
                    <span style="color: var(--text-secondary);">{{ brand.total }} total</span>
                    <span style="color: #3fb950;">{{ brand.approved }} <i class="fas fa-check"></i></span>
                    <span style="color: #d29922;">{{ brand.pending }} <i class="fas fa-clock"></i></span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhuma marca cadastrada.</p>
        {% endif %}
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="font-size: 1rem;">Por Coleção</h3>
        </div>
        {% if collections_stats %}
        <div style="display: flex; flex-direction: column; gap: 0.75rem; max-height: 200px; overflow-y: auto;">
            {% for collection in collections_stats %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 6px;">
                <span style="font-weight: 500;">{{ collection.name }}</span>
                <span style="color: var(--text-secondary);">{{ collection.total }} imagens</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p style="color: var(--text-secondary); font-size: 0.9rem;">Nenhuma coleção cadastrada.</p>
        {% endif %}
    </div>
</div>

<div class="stat-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 style="font-size: 1rem;">Últimos Uploads</h3>
        <a href="{{ url_for('catalog') }}" style="color: var(--accent-blue); font-size: 0.9rem;">Ver todos <i class="fas fa-arrow-right"></i></a>
    </div>
    
    {% if recent_uploads %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <th style="text-align: left; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">Imagem</th>
                    <th style="text-align: left; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">SKU</th>
                    <th style="text-align: left; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">Marca</th>
                    <th style="text-align: left; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">Status</th>
                    <th style="text-align: left; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">Data</th>
                    <th style="text-align: right; padding: 0.75rem; font-weight: 500; color: var(--text-secondary); font-size: 0.85rem;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for img in recent_uploads %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" 
                                 style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px;">
                            <span style="font-size: 0.9rem;">{{ img.original_name[:30] }}{% if img.original_name|length > 30 %}...{% endif %}</span>
                        </div>
                    </td>
                    <td style="padding: 0.75rem; font-size: 0.9rem;">{{ img.sku or '-' }}</td>
                    <td style="padding: 0.75rem; font-size: 0.9rem;">{{ img.brand_ref.name if img.brand_ref else '-' }}</td>
                    <td style="padding: 0.75rem;">
                        <span class="status-badge status-{{ img.status.lower() }}">{{ img.status }}</span>
                    </td>
                    <td style="padding: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">{{ img.upload_date.strftime('%d/%m/%Y') }}</td>
                    <td style="padding: 0.75rem; text-align: right;">
                        <a href="{{ url_for('image_detail', id=img.id) }}" class="btn" style="padding: 0.4rem 0.75rem; font-size: 0.8rem; background: var(--bg-tertiary);">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Nenhuma imagem enviada ainda.</p>
    {% endif %}
</div>
{% endblock %}

================================================================================
ARQUIVO: ./templates/analytics/index.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Análises e Métricas</h1>
    <p style="color: var(--text-secondary);">Visualize estatísticas detalhadas e insights do seu banco de imagens.</p>
</div>

<div class="dashboard-stats">
    <div class="stat-card">
        <div class="stat-title">Taxa de Crescimento</div>
        <div class="stat-value">+12.5%</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i> vs. mês anterior
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Tempo Médio de Aprovação</div>
        <div class="stat-value">2.3h</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-down"></i> -15% mais rápido
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Uso de Armazenamento</div>
        <div class="stat-value">68%</div>
        <div class="stat-change negative">
            <i class="fas fa-arrow-up"></i> +5% este mês
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Precisão da IA</div>
        <div class="stat-value">94%</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i> +3.2%
        </div>
    </div>
</div>

<div class="charts-grid" style="margin-top: 2rem;">
    <div style="grid-column: 1 / -1;">
        <div class="chart-card">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                <div>
                    <h3>Uploads por Período</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Últimos 30 dias</p>
                </div>
                <select class="form-control" style="width: 150px;">
                    <option>Últimos 7 dias</option>
                    <option selected>Últimos 30 dias</option>
                    <option>Últimos 90 dias</option>
                    <option>Este ano</option>
                </select>
            </div>
            <canvas id="uploadsChart" style="max-height: 300px;"></canvas>
        </div>
    </div>

    <div>
        <div class="chart-card">
            <h3 style="margin-bottom: 1.5rem;">Distribuição por Status</h3>
            <canvas id="statusChart"></canvas>
        </div>
    </div>

    <div>
        <div class="chart-card">
            <h3 style="margin-bottom: 1.5rem;">Top 10 Tags Mais Usadas</h3>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem;">Casual</span>
                    <div style="flex: 1; margin: 0 1rem; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: 85%; height: 100%; background: var(--accent-blue);"></div>
                    </div>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">850</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem;">Denim</span>
                    <div style="flex: 1; margin: 0 1rem; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: 72%; height: 100%; background: var(--accent-purple);"></div>
                    </div>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">720</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem;">Cotton</span>
                    <div style="flex: 1; margin: 0 1rem; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: 65%; height: 100%; background: var(--accent-pink);"></div>
                    </div>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">650</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem;">Blue</span>
                    <div style="flex: 1; margin: 0 1rem; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: 58%; height: 100%; background: var(--accent-blue);"></div>
                    </div>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">580</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.9rem;">Formal</span>
                    <div style="flex: 1; margin: 0 1rem; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: 45%; height: 100%; background: var(--accent-purple);"></div>
                    </div>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);">450</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Uploads Chart
    const ctxUploads = document.getElementById('uploadsChart').getContext('2d');
    new Chart(ctxUploads, {
        type: 'line',
        data: {
            labels: ['1', '3', '5', '7', '9', '11', '13', '15', '17', '19', '21', '23', '25', '27', '29', '30'],
            datasets: [{
                label: 'Uploads',
                data: [45, 52, 38, 65, 59, 80, 81, 56, 55, 40, 68, 72, 85, 90, 78, 95],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    grid: { color: 'rgba(255,255,255,0.05)' },
                    ticks: { color: '#9ca3af' }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: '#9ca3af' }
                }
            }
        }
    });

    // Status Chart
    const ctxStatus = document.getElementById('statusChart').getContext('2d');
    new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
            labels: ['Aprovado', 'Pendente', 'Rejeitado'],
            datasets: [{
                data: [65, 25, 10],
                backgroundColor: ['#3fb950', '#d29922', '#f85149'],
                borderWidth: 0
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom', labels: { color: '#9ca3af' } }
            }
        }
    });
</script>
{% endblock %}

================================================================================
ARQUIVO: ./templates/integrations/index.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Integrações</h1>
    <p style="color: var(--text-secondary);">Gerencie conexões com plataformas de e-commerce e serviços externos.</p>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
    <!-- Shopify Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: #95BF47; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    S
                </div>
                <div>
                    <h3 style="margin: 0;">Shopify</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">E-commerce</span>
                </div>
            </div>
            <span class="status-badge status-approved"
                style="background: rgba(63, 185, 80, 0.1); color: #3fb950;">Conectado</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Sincronize automaticamente imagens de produtos com sua loja Shopify.
        </p>
        <div
            style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 6px;">
            <div>
                <div style="color: var(--text-secondary);">Última Sincronização</div>
                <div style="font-weight: 600; margin-top: 0.25rem;">2 minutos atrás</div>
            </div>
            <div style="text-align: right;">
                <div style="color: var(--text-secondary);">Imagens Sincronizadas</div>
                <div style="font-weight: 600; margin-top: 0.25rem;">1,234</div>
            </div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn"
                style="flex: 1; background: var(--bg-tertiary); color: var(--text-primary); justify-content: center;">
                <i class="fas fa-cog"></i> Configurar
            </button>
            <button class="btn"
                style="background: rgba(248, 81, 73, 0.1); color: #f85149; border: 1px solid rgba(248, 81, 73, 0.4);">
                <i class="fas fa-unlink"></i>
            </button>
        </div>
    </div>

    <!-- Magento Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: #EE672F; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    M
                </div>
                <div>
                    <h3 style="margin: 0;">Magento</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">E-commerce</span>
                </div>
            </div>
            <span class="status-badge status-rejected"
                style="background: rgba(248, 81, 73, 0.1); color: #f85149;">Erro</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Integração com Magento para sincronização de catálogo de produtos.
        </p>
        <div
            style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 1rem; padding: 0.75rem; background: rgba(248, 81, 73, 0.05); border: 1px solid rgba(248, 81, 73, 0.2); border-radius: 6px;">
            <div>
                <div style="color: #f85149;">Erro de Autenticação</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">Verifique suas
                    credenciais</div>
            </div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-primary" style="flex: 1; justify-content: center;">
                <i class="fas fa-sync"></i> Reconectar
            </button>
            <button class="btn" style="background: var(--bg-tertiary); color: var(--text-primary);">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </div>

    <!-- WooCommerce Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: #96588A; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    W
                </div>
                <div>
                    <h3 style="margin: 0;">WooCommerce</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">E-commerce</span>
                </div>
            </div>
            <span class="status-badge status-pending"
                style="background: rgba(210, 153, 34, 0.1); color: #d29922;">Disponível</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Conecte seu banco de imagens com lojas WooCommerce.
        </p>
        <div style="padding: 2rem 0; text-align: center; color: var(--text-secondary);">
            <i class="fas fa-plug" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
            <div style="font-size: 0.9rem;">Não configurado</div>
        </div>
        <button class="btn btn-primary" style="width: 100%; justify-content: center;">
            <i class="fas fa-plus"></i> Conectar Agora
        </button>
    </div>

    <!-- Google Drive Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: linear-gradient(135deg, #4285F4, #34A853, #FBBC05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    G
                </div>
                <div>
                    <h3 style="margin: 0;">Google Drive</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Armazenamento</span>
                </div>
            </div>
            <span class="status-badge status-pending"
                style="background: rgba(210, 153, 34, 0.1); color: #d29922;">Disponível</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Faça backup automático das suas imagens no Google Drive.
        </p>
        <div style="padding: 2rem 0; text-align: center; color: var(--text-secondary);">
            <i class="fas fa-cloud" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
            <div style="font-size: 0.9rem;">Não configurado</div>
        </div>
        <button class="btn btn-primary" style="width: 100%; justify-content: center;">
            <i class="fas fa-plus"></i> Conectar Agora
        </button>
    </div>

    <!-- Dropbox Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: #0061FF; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    D
                </div>
                <div>
                    <h3 style="margin: 0;">Dropbox</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Armazenamento</span>
                </div>
            </div>
            <span class="status-badge status-pending"
                style="background: rgba(210, 153, 34, 0.1); color: #d29922;">Disponível</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Sincronize imagens com sua conta Dropbox Business.
        </p>
        <div style="padding: 2rem 0; text-align: center; color: var(--text-secondary);">
            <i class="fas fa-folder" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
            <div style="font-size: 0.9rem;">Não configurado</div>
        </div>
        <button class="btn btn-primary" style="width: 100%; justify-content: center;">
            <i class="fas fa-plus"></i> Conectar Agora
        </button>
    </div>

    <!-- Webhook Integration -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div
                    style="width: 48px; height: 48px; background: var(--accent-purple); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem;">
                    <i class="fas fa-code"></i>
                </div>
                <div>
                    <h3 style="margin: 0;">Webhooks</h3>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">API Personalizada</span>
                </div>
            </div>
            <span class="status-badge status-pending"
                style="background: rgba(210, 153, 34, 0.1); color: #d29922;">Disponível</span>
        </div>
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
            Configure webhooks personalizados para integração com sistemas externos.
        </p>
        <div style="padding: 2rem 0; text-align: center; color: var(--text-secondary);">
            <i class="fas fa-terminal" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
            <div style="font-size: 0.9rem;">Não configurado</div>
        </div>
        <button class="btn btn-primary" style="width: 100%; justify-content: center;">
            <i class="fas fa-plus"></i> Configurar Webhook
        </button>
    </div>
</div>

<div class="stat-card"
    style="margin-top: 2rem; padding: 1.5rem; background: rgba(31, 111, 235, 0.05); border-color: rgba(31, 111, 235, 0.2);">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <i class="fas fa-info-circle" style="font-size: 1.5rem; color: var(--accent-blue);"></i>
        <div>
            <h4 style="margin: 0 0 0.25rem 0;">Precisa de uma integração personalizada?</h4>
            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                Entre em contato com nossa equipe de suporte para discutir integrações customizadas para seu negócio.
            </p>
        </div>
        <button class="btn btn-primary" style="margin-left: auto;">
            <i class="fas fa-envelope"></i> Contatar Suporte
        </button>
    </div>
</div>
{% endblock %}
================================================================================
ARQUIVO: ./templates/admin/settings.html
================================================================================
{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Configurações</h1>
    <p style="color: var(--text-secondary);">Configure as definições do sistema e integrações.</p>
</div>

<div class="stat-card" style="max-width: 600px;">
    <h3 style="margin-bottom: 1.5rem;">Configuração de IA</h3>

    <form method="POST">
        <div class="form-group">
            <label class="form-label">Chave API OpenAI</label>
            <div style="position: relative;">
                <input type="password" name="api_key" class="form-control" value="{{ current_key }}"
                    placeholder="sk-..." required>
                <i class="fas fa-key"
                    style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
            </div>
            <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                Esta chave será usada para análise de imagens e marcação automática.
                <a href="https://platform.openai.com/api-keys" target="_blank"
                    style="color: var(--accent-blue);">Obtenha uma chave aqui</a>.
            </p>
        </div>

        <div
            style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end;">
            <button type="submit" class="btn btn-primary">
                Salvar Configuração
            </button>
        </div>
    </form>
</div>
{% endblock %}
================================================================================
ARQUIVO: ./static/css/style.css
================================================================================
:root {
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-tertiary: #21262d;
    --text-primary: #f0f6fc;
    --text-secondary: #8b949e;
    --accent-primary: #238636; /* Greenish from screenshot or Blue */
    --accent-blue: #1f6feb;
    --border-color: #30363d;
    --card-bg: #161b22;
    --hover-bg: #21262d;
    --font-main: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-main);
    background-color: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.5;
    height: 100vh;
    display: flex;
    overflow: hidden;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 600;
}

a {
    text-decoration: none;
    color: var(--accent-blue);
}

/* Layout */
.app-container {
    display: flex;
    width: 100%;
    height: 100%;
}

/* Sidebar */
.sidebar {
    width: 260px;
    background-color: var(--bg-secondary);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    flex-shrink: 0;
}

.logo-area {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 2.5rem;
}

.logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #1f6feb, #8b5cf6);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
}

.nav-menu {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    flex: 1;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: 6px;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

.nav-item:hover, .nav-item.active {
    background-color: rgba(31, 111, 235, 0.1);
    color: var(--accent-blue);
}

.nav-item i {
    width: 20px;
    text-align: center;
}

.bottom-menu {
    margin-top: auto;
    border-top: 1px solid var(--border-color);
    padding-top: 1rem;
}

/* Main Content */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background-color: var(--bg-primary);
}

/* Header */
.top-header {
    height: 70px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    background-color: var(--bg-primary);
}

.search-bar {
    position: relative;
    width: 400px;
}

.search-bar input {
    width: 100%;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    padding: 10px 16px 10px 40px;
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.search-bar i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.icon-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 1.1rem;
}

.user-profile {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    overflow: hidden;
}

.user-profile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Content Area */
.content-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
}

/* Dashboard Grid */
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1.5rem;
}

.stat-title {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stat-change {
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat-change.positive { color: #3fb950; }
.stat-change.negative { color: #f85149; }

/* Charts Area */
.charts-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.chart-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1.5rem;
    min-height: 300px;
}

/* Buttons */
.btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background-color: var(--accent-blue);
    color: white;
}

.btn-primary:hover {
    background-color: #1158c7;
}

/* Auth Pages */
.auth-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100vh;
    background-color: var(--bg-primary);
}

.auth-box {
    width: 400px;
    padding: 2rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
}

.auth-title {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    text-align: center;
}

.form-group {
    margin-bottom: 1.2rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.form-control {
    width: 100%;
    padding: 10px;
    background-color: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-primary);
}

.form-control:focus {
    outline: none;
    border-color: var(--accent-blue);
}

/* Image Grid */
.image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
}

.image-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s;
}

.image-card:hover {
    transform: translateY(-2px);
    border-color: var(--accent-blue);
}

.image-preview {
    height: 200px;
    width: 100%;
    object-fit: cover;
    background-color: var(--bg-tertiary);
}

.image-info {
    padding: 1rem;
}

.image-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.image-meta {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.status-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    margin-top: 0.5rem;
}

.status-pendente { background-color: rgba(210, 153, 34, 0.2); color: #d29922; }
.status-aprovado { background-color: rgba(63, 185, 80, 0.2); color: #3fb950; }
.status-rejeitado { background-color: rgba(248, 81, 73, 0.2); color: #f85149; }

/* Upload Area */
.upload-area {
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    height: 400px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: rgba(22, 27, 34, 0.5);
    transition: all 0.3s;
}

.upload-area:hover {
    border-color: var(--accent-blue);
    background-color: rgba(31, 111, 235, 0.05);
}

.upload-icon {
    font-size: 3rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
}

================================================================================
FIM DO BUNDLE
================================================================================
