{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Busca & Catálogo de Imagens</h1>
        <p style="color: var(--text-secondary);">Mostrando {{ images|length }} resultados</p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('upload') }}" class="btn btn-primary">
            <i class="fas fa-cloud-upload-alt"></i> Enviar Nova
        </a>
        <button class="btn"
            style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
            <i class="fas fa-file-export"></i> Exportar para CSV
        </button>
    </div>
</div>

<div style="display: flex; gap: 2rem;">
    <!-- Filters Sidebar -->
    <div style="width: 250px; flex-shrink: 0;">
        <form action="{{ url_for('catalog') }}" method="GET" style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1rem; margin-bottom: 1rem;">Filtros</h3>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Buscar</label>
                <input type="text" name="q" class="form-control" placeholder="SKU, descrição, tags..." value="{{ search_query or '' }}">
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Coleção</label>
                <select name="collection_id" class="form-control">
                    <option value="all">Todas as Coleções</option>
                    {% for collection in collections %}
                    <option value="{{ collection.id }}" {% if request.args.get('collection_id')==collection.id|string %}selected{% endif %}>
                        {{ collection.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Marca</label>
                <select name="brand_id" class="form-control">
                    <option value="all">Todas as Marcas</option>
                    {% for brand in brands %}
                    <option value="{{ brand.id }}" {% if request.args.get('brand_id')==brand.id|string %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Status</label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Aprovado" {% if 'Aprovado' in request.args.getlist('status') %}checked{% endif %}> Aprovado
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Pendente" {% if 'Pendente' in request.args.getlist('status') %}checked{% endif %}> Pendente
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem;">
                        <input type="checkbox" name="status" value="Rejeitado" {% if 'Rejeitado' in request.args.getlist('status') %}checked{% endif %}> Rejeitado
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">Aplicar Filtros</button>
            <a href="{{ url_for('catalog') }}" class="btn" style="width: 100%; justify-content: center; margin-top: 0.5rem; border: 1px solid var(--border-color); color: var(--text-primary);">Limpar</a>
        </form>
    </div>

    <!-- Image Grid -->
    <div style="flex: 1;">
        <div class="image-grid">
            {% for image in images %}
            <div class="image-card">
                <div style="position: relative;">
                    <a href="{{ url_for('image_detail', id=image.id) }}">
                        <img src="{{ image.image_url }}" class="image-preview"
                            alt="{{ image.original_name }}">
                    </a>
                    <div style="position: absolute; top: 8px; left: 8px;">
                        <input type="checkbox" style="transform: scale(1.2);">
                    </div>
                    <div style="position: absolute; top: 8px; right: 8px;">
                        <form action="{{ url_for('delete_image', id=image.id) }}" method="POST"
                            onsubmit="return confirm('Deletar esta imagem?');">
                            <button type="submit"
                                style="background: rgba(0,0,0,0.5); border: none; color: #f85149; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-trash-alt" style="font-size: 0.8rem;"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <div class="image-info">
                    <div class="image-title">{{ image.sku or 'Sem SKU' }}</div>
                    <div class="image-meta">{{ image.brand_ref.name if image.brand_ref else 'Sem Marca' }}</div>
                    <div class="status-badge status-{{ image.status.lower() }}">
                        {{ image.status }}
                    </div>
                    <div style="margin-top: 0.5rem; display: flex; gap: 4px; flex-wrap: wrap;">
                        {% for tag in image.tag_list[:3] %}
                        <span
                            style="font-size: 0.7rem; background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">{{
                            tag }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% else %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-secondary);">
                <i class="far fa-images" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <p>Nenhuma imagem encontrada. Envie algumas imagens para começar.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}